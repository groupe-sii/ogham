<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="2.0.0-SNAPSHOT">
<title>Ogham</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="..//javascripts/steps.js"></script>
<script type="text/javascript" src="..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="..//javascripts/tabcontainer.js"></script>
<link rel="stylesheet" type="text/css" href="..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="..//styles/sourcecode/highlight-lines.css" />
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Ogham</h1>
<div class="details">
<span id="author" class="author">2.0.0-SNAPSHOT</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_existing_libraries">Existing libraries</a></li>
<li><a href="#_the_ogham_module">The Ogham module</a></li>
</ul>
</li>
<li><a href="#_quick_start">Quick start</a>
<ul class="sectlevel2">
<li><a href="#install">Quick and simple inclusion</a></li>
<li><a href="#_select_the_features_you_need">Select the features you need</a></li>
</ul>
</li>
<li><a href="#_usage">Usage</a>
<ul class="sectlevel2">
<li><a href="#email-usage">Send Email</a></li>
<li><a href="#sms-usage">Send SMS</a></li>
<li><a href="#resource-resolution">Resource resolution</a></li>
<li><a href="#properties-handling">Properties handling</a></li>
<li><a href="#_templating">Templating</a></li>
<li><a href="#spring-boot-usage">Using Ogham in a Spring Boot application</a></li>
</ul>
</li>
<li><a href="#_testing">Testing</a>
<ul class="sectlevel2">
<li><a href="#testing-tools">Include test utilities</a></li>
<li><a href="#testing-email">Testing emails</a></li>
<li><a href="#testing-sms">Tesing SMS</a></li>
</ul>
</li>
<li><a href="#_advanced_configuration">Advanced configuration</a>
<ul class="sectlevel2">
<li><a href="#_use_the_builder_to_define_your_own_behaviors">Use the builder to define your own behaviors</a></li>
</ul>
</li>
<li><a href="#_extend">Extend</a>
<ul class="sectlevel2">
<li><a href="#_create_your_own_configurer">Create your own configurer</a></li>
<li><a href="#_use_a_custom_message_sender">Use a custom message sender</a></li>
<li><a href="#_use_your_custom_template_engine">Use your custom template engine</a></li>
<li><a href="#custom-resource-resolver">Create custom resource resolver</a></li>
</ul>
</li>
<li><a href="#_tips">Tips</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_existing_libraries"><a class="anchor" href="#_existing_libraries"></a>Existing libraries</h3>
<div class="paragraph">
<p>Several libraries for sending email already exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://commons.apache.org/proper/commons-email/">Apache Commons Email</a></p>
</li>
<li>
<p><a href="https://github.com/bbottema/simple-java-mail">Simple Java Mail/Vesijama</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mail.html">Spring Email Integration</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These libraries help you send an email but if you want to use a templated content, you will have to manually integrate a template engine.</p>
</div>
<div class="paragraph">
<p>These libraries also provide only implementations based on Java Mail API. But in some environments, you might NOT want to send the email directly but to use a web service to do it for you (<a href="https://sendgrid.com/">SendGrid</a> for example). Furthermore, those libraries are bound by design to frameworks or libraries that you might not want to use in your own context.</p>
</div>
<div class="paragraph">
<p>So, now you would want to find a sending library with a high level of abstraction to avoid binding issues with any template engine, design framework or sender service&#8230;&#8203; Is email the only possible message type ? No, so why not sending SMS, Tweet or anything the same way ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_ogham_module"><a class="anchor" href="#_the_ogham_module"></a>The Ogham module</h3>
<div class="paragraph">
<p>This module is designed for handling any kind of message the same way. It also provides several implementations for the same message type. It selects the best implementation based on the classpath or properties for example. You can easily add your own implementation.</p>
</div>
<div class="paragraph">
<p>It also provides <strong>templating support</strong> and integrates natively several template engines. You can also add your own.</p>
</div>
<div class="paragraph">
<p>It is <strong>framework and library agnostic</strong> and provides bridges for <strong>common frameworks integration</strong> (Spring, JSF, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>When using the module to send email based on an HTML template, the templating system let you <strong>design your HTML like a standard HTML page</strong>. It automatically transforms the associated resources (images, css files&#8230;&#8203;) to be usable in an email context (automatic inline css, embed images&#8230;&#8203;). You don&#8217;t need to write your HTML specifically for email.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_start"><a class="anchor" href="#_quick_start"></a>Quick start</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="install"><a class="anchor" href="#install"></a>Quick and simple inclusion</h3>
<div class="sect3">
<h4 id="_standalone"><a class="anchor" href="#_standalone"></a>Standalone</h4>
<div class="paragraph tab-container">
<p>Include Ogham standalone dependency</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/maven-logo.png" alt="Maven" width="118" height="30"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>fr.sii.ogham<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>ogham-all<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/pom.xml?ts=4">View code of an example pom.xml</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/gradlephant-logo.png" alt="Gradle" width="114" height="30"></span></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>This will include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sending email through SMTP server (using <a href="https://javaee.github.io/javamail/">JavaMail</a>)</p>
</li>
<li>
<p>Sending email through <a href="https://sendgrid.com/">SendGrid</a></p>
</li>
<li>
<p>Sending SMS through SMPP server (using <a href="https://github.com/fizzed/cloudhopper-smpp">Cloudhopper</a>)</p>
</li>
<li>
<p>Sending SMS through <a href="https://www.ovhtelecom.fr/sms/api-sms.xml">OVH SMS API</a></p>
</li>
<li>
<p><a href="http://freemarker.org/">FreeMarker</a> template engine available for building message contents</p>
</li>
<li>
<p><a href="http://www.thymeleaf.org/">ThymeLeaf</a> template engine available for building message contents</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="install-spring-boot"><a class="anchor" href="#install-spring-boot"></a>With Spring Boot</h4>
<div class="paragraph tab-container">
<p>Include Ogham dependency for Spring Boot</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/maven-logo.png" alt="Maven" width="118" height="30"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>fr.sii.ogham<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>ogham-spring-boot-starter-all<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/pom.xml?ts=4">View code of an example pom.xml with Spring Boot starter</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/gradlephant-logo.png" alt="Gradle" width="114" height="30"></span></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>This will include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sending email through SMTP server (using <a href="https://javaee.github.io/javamail/">JavaMail</a>)</p>
</li>
<li>
<p>Sending email through <a href="https://sendgrid.com/">SendGrid</a></p>
</li>
<li>
<p>Sending SMS through SMPP server (using <a href="https://github.com/fizzed/cloudhopper-smpp">Cloudhopper</a>)</p>
</li>
<li>
<p>Sending SMS through <a href="https://www.ovhtelecom.fr/sms/api-sms.xml">OVH SMS API</a></p>
</li>
<li>
<p><a href="http://freemarker.org/">FreeMarker</a> template engine available for building message contents</p>
</li>
<li>
<p><a href="http://www.thymeleaf.org/">ThymeLeaf</a> template engine available for building message contents</p>
</li>
<li>
<p>Support of <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> auto-detection mechanism and configuration properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can combine Ogham with existing Spring Boot dependencies:</p>
</div>
<div class="paragraph tab-container">
<p>Ogham with Spring Boot dependencies</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/maven-logo.png" alt="Maven" width="118" height="30"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>fr.sii.ogham<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>ogham-spring-boot-starter-all<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/gradlephant-logo.png" alt="Gradle" width="114" height="30"></span></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Ogham will auto-configure to use Spring Boot additions and support Spring Boot configuration properties like <code>spring.mail.host</code> for example.</p>
</div>
<div class="paragraph">
<p>Ogham has been tested with following Spring Boot versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1.3.8</p>
</li>
<li>
<p>1.4.6</p>
</li>
<li>
<p>1.5.3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using Java 8 and Java 7.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_select_the_features_you_need"><a class="anchor" href="#_select_the_features_you_need"></a>Select the features you need</h3>
<div class="sect3">
<h4 id="_standalone_2"><a class="anchor" href="#_standalone_2"></a>Standalone</h4>

</div>
<div class="sect3">
<h4 id="_with_spring_boot"><a class="anchor" href="#_with_spring_boot"></a>With Spring Boot</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All samples with templates are using ThymeLeaf as template engine. For FreeMarker samples, take a look at <a href="#freemarker">FreeMarker section</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="email-usage"><a class="anchor" href="#email-usage"></a>Send Email</h3>
<div class="paragraph">
<p>The samples are available in the <a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage">sample-standard-usage sub-project</a>.</p>
</div>
<div class="paragraph">
<p>All samples shown bellow are using SMTP for sending email. See <a href="#sendgrid">Sending email through SendGrid</a> to know how to send email using SendGrid HTTP API.</p>
</div>
<div class="sect3">
<h4 id="_first_email_using_an_existing_smtp_server"><a class="anchor" href="#_first_email_using_an_existing_smtp_server"></a>First email using an existing SMTP server</h4>
<div class="paragraph">
<p>This sample shows how to send a basic email.</p>
</div>
<div class="paragraph">
<p>The first lines configure the properties that will be used by the sender.
Then you must create the service. You can use the MessagingBuilder to help you to create the service.
Finally, the last line sends the email. The specified email is really basic. It only contains the subject, the textual content and the receiver address. The sender address is automatically added to the email by the service based on configuration properties.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Basic sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-9 irrelevant-lines:1-9">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BasicSample</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()      <i class="conum" data-value="1"></i><b>(1)</b>
                .environment()
                    .properties(properties)                         <i class="conum" data-value="2"></i><b>(2)</b>
                    .and()
                .build();                                           <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="comment">// send the email using fluent API</span>
        service.send(<span class="keyword">new</span> Email()                                    <i class="conum" data-value="4"></i><b>(4)</b>
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">email content</span><span class="delimiter">&quot;</span></span>)
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the standard builder (predefined behavior)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register the custom properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a MessagingService instance</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send an email with a subject and a simple body. The sender address is automatically set using <code>ogham.email.from</code> property</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/BasicSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>The construction of the email is done using a fluent API in order to chain calls and to have a more readable code.</p>
</div>
<div class="paragraph">
<p>Properties are directly provided in the code. You can instead <a href="#properties-handling">use a configuration file</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="email-template"><a class="anchor" href="#email-template"></a>Use an HTML template for email body</h4>
<div class="paragraph">
<p>This sample shows how to send an email with a content following a template engine language.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample with template</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10,35-47 irrelevant-lines:1-10,13-20 highlight-lines:29-30">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HtmlTemplateSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()                                          <i class="conum" data-value="1"></i><b>(1)</b>
                .environment()
                    .properties(properties)                                                             <i class="conum" data-value="2"></i><b>(2)</b>
                    .and()
                .build();                                                                               <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="comment">// send the email using fluent API</span>
        service.send(<span class="keyword">new</span> Email()                                                                        <i class="conum" data-value="4"></i><b>(4)</b>
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/thymeleaf/simple.html</span><span class="delimiter">&quot;</span></span>,       <i class="conum" data-value="5"></i><b>(5)</b>
                                                    <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))                         <i class="conum" data-value="6"></i><b>(6)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the standard builder (predefined behavior)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register the custom properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a MessagingService instance</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send an email with a subject and a simple body that comes from the evaluated template. The sender address is automatically set using <code>ogham.email.from</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Indicate the path to the HTML template file (in the classpath)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use any bean object for replacing variables in template</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/HtmlTemplateSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> ThymeLeaf template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>       <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>         <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Include the ThymeLeaf namespace</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>name</code> attribute value in the template</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the <code>value</code> attribute value in the template</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/thymeleaf/simple.html?ts=4">Source code of the HTML template</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Using a template is straightforward. Instead of providing a string content, you provide a <code>TemplateContent</code>.
The <code>TemplateContent</code> requires two information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The path to the template</p>
</li>
<li>
<p>The variables to evaluate in the template</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The path to the template is a string with a <strong>lookup</strong> prefix. The lookup prefix is used to indicate where to search the template (from file system, from classpath or anywhere else). Here we explicitly ask to load the template from classpath (using prefix <code>classpath:</code>). If no lookup is defined, classpath is used by default. See <a href="#resource-resolution">Resource resolution section</a> for more information.</p>
</div>
<div class="paragraph">
<p>The variables are any object you are using in your application. No need to convert your object to a particular format. Directly use what you want.</p>
</div>
</div>
<div class="sect3">
<h4 id="html-title-subject"><a class="anchor" href="#html-title-subject"></a>Use HTML title as email subject</h4>
<div class="paragraph">
<p>This sample is a variant of the previous one. It allows you to directly use the HTML title as subject of your email. It may be useful to use variables in the subject too, to mutualize the code and to avoid to create a new file just for one line.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample with template</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-11,36-48 irrelevant-lines:1-11,13-20">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HtmlTemplateWithSubjectSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using fluent API (do not specify subject)</span>
        <span class="comment">// subject is set to null to let automatic mechanism to read the title</span>
        <span class="comment">// of the HTML and use it as subject of your email</span>
        service.send(<span class="keyword">new</span> Email()                                                                                <i class="conum" data-value="1"></i><b>(1)</b>
                        .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/thymeleaf/simpleWithSubject.html</span><span class="delimiter">&quot;</span></span>,
                                                    <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Subject is no more in Java code</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/HtmlTemplateWithSubjectSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> ThymeLeaf template</p>
</div>
<div class="listingblock highlight-lines:4">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Subject of the email - ${name}<span class="tag">&lt;/title&gt;</span>               <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The subject is defined in the template and can use same evaluation context (<code>SimpleBean</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/thymeleaf/simpleWithSubject.html?ts=4">Source code of the HTML template</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>For text templates, the subject is automatically used (like for HTML title) if the first line starts with <code>Subject:</code> (spaces can be added after colon). Other lines are used as content of the email.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample with template</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10,36-48 irrelevant-lines:1-10,13-20">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TextTemplateWithSubjectSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using fluent API (do not specify subject)</span>
        <span class="comment">// subject is set to null to let automatic mechanism to read the title</span>
        <span class="comment">// of the first line if prefixed by &quot;Subject:&quot; and use it as subject of your email</span>
        service.send(<span class="keyword">new</span> Email()                                                                                <i class="conum" data-value="1"></i><b>(1)</b>
                        .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/freemarker/simpleWithSubject.txt.ftl</span><span class="delimiter">&quot;</span></span>,
                                                    <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Subject is no more in Java code</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/TextTemplateWithSubjectSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/freemarker-logo.png" alt="freemarker logo" width="60" height="24"></span> Text template</p>
</div>
<div class="listingblock highlight-lines:1">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Subject: Welcome ${name} !
Hello ${name},

Foo bar ${value}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The subject of the email will be <code>Welcome foo !</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/freemarker/simpleWithSubject.txt.ftl?ts=4">Source code of the text template</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="css-images-inlining"><a class="anchor" href="#css-images-inlining"></a>HTML body with CSS and images</h4>
<div class="paragraph">
<p>When you develop a Web application, you can use HTML for the content and CSS for layout and theming. HTML and CSS can use images to make a beautiful Web page. Each concern is separated in a different file. This is a good practice.</p>
</div>
<div class="paragraph">
<p>However, writing an HTML email is totally different. Indeed, email clients are not as evolved as Web browsers. Even worse, some clients disable some features on purpose (like Inbox that prevents using <code>style</code> tag). To make an email work on several clients, you should follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;img&gt;</code> tags that use local images must be embedded</p>
</li>
<li>
<p>Use XHTML instead of HTML</p>
</li>
<li>
<p>Remove HTML comments (except conditional comments used to target Outlook)</p>
</li>
<li>
<p>Add border=0 on all images to avoid an ugly border</p>
</li>
<li>
<p>Do not write shortcut CSS values (<code>padding: 4px 4px 4px 4px;</code> instead of <code>padding: 4px</code>)</p>
</li>
<li>
<p>Padding is not supported on some clients so you must use margins instead (adding a parent just for the layout)</p>
</li>
<li>
<p>Background images on body should be moved on another node</p>
</li>
<li>
<p>CSS3 properties are not supported</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are many other rules but the developer should not be constrained and should be able to write its HTML and CSS like as usual in Web browsers. Ogham simplifies image and CSS integration and is able to partially rewrite the HTML.</p>
</div>
<div class="paragraph tab-container">
<p>Sample with template</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10,37-49 irrelevant-lines:1-10,13-20 highlight-lines:31,32">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiTemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HtmlWithImagesAndCssTemplateSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using fluent API</span>
        <span class="comment">// Note that the extension of the template is not given. This version</span>
        <span class="comment">// automatically takes the provided path and adds the '.html' extension</span>
        <span class="comment">// for the HTML template and '.txt.ftl' for text template</span>
        service.send(<span class="keyword">new</span> Email()
                        .content(<span class="keyword">new</span> MultiTemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/resources</span><span class="delimiter">&quot;</span></span>,     <i class="conum" data-value="1"></i><b>(1)</b>
                                                            <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))                         <i class="conum" data-value="2"></i><b>(2)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The path to the templates</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The template context</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/HtmlWithImagesAndCssTemplateSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf-html.jpg" alt="thymeleaf html" width="30" height="30"></span> ThymeLeaf template</p>
</div>
<div class="listingblock highlight-lines:4">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
<span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;title&gt;</span>Demystifying Email Design<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;link</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/css/external1.css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;link</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/css/external2.css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body_2a02_0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tr&gt;</span>
            <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;table</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">600</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">table_2a02_0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">bgcolor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#70bbd9</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                            <span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/images/h1.gif</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Creating Email Magic</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">230</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                        <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;/tr&gt;</span>
                    <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td</span> <span class="attribute-name">bgcolor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#ffffff</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                            <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                <span class="tag">&lt;tr&gt;</span>
                                    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                        <span class="tag">&lt;b</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${name}<span class="tag">&lt;/b&gt;</span>
                                    <span class="tag">&lt;/td&gt;</span>
                                <span class="tag">&lt;/tr&gt;</span>
                                <span class="tag">&lt;tr&gt;</span>
                                    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">paragraph</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                    <span class="tag">&lt;/td&gt;</span>
                                <span class="tag">&lt;/tr&gt;</span>
                                <span class="tag">&lt;tr&gt;</span>
                                    <span class="tag">&lt;td&gt;</span>
                                        <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                            <span class="tag">&lt;tr&gt;</span>
                                                <span class="tag">&lt;td</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">260</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                    <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                        <span class="tag">&lt;tr&gt;</span>
                                                            <span class="tag">&lt;td&gt;</span>
                                                                <span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/images/left.gif</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">140</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                                                            <span class="tag">&lt;/td&gt;</span>
                                                        <span class="tag">&lt;/tr&gt;</span>
                                                        <span class="tag">&lt;tr&gt;</span>
                                                            <span class="tag">&lt;td</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">paragraph</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. In tempus adipiscing felis, sit amet blandit ipsum volutpat sed. Morbi porttitor, eget accumsan dictum, nisi libero ultricies ipsum, in posuere mauris neque at erat.
                                                            <span class="tag">&lt;/td&gt;</span>
                                                        <span class="tag">&lt;/tr&gt;</span>
                                                    <span class="tag">&lt;/table&gt;</span>
                                                <span class="tag">&lt;/td&gt;</span>
                                                <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_6</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                    <span class="entity">&amp;nbsp;</span>
                                                <span class="tag">&lt;/td&gt;</span>
                                                <span class="tag">&lt;td</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">260</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                    <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                        <span class="tag">&lt;tr&gt;</span>
                                                            <span class="tag">&lt;td&gt;</span>
                                                                <span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/images/right.gif</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">140</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                                                            <span class="tag">&lt;/td&gt;</span>
                                                        <span class="tag">&lt;/tr&gt;</span>
                                                        <span class="tag">&lt;tr&gt;</span>
                                                            <span class="tag">&lt;td</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">paragraph</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. In tempus adipiscing felis, sit amet blandit ipsum volutpat sed. Morbi porttitor, eget accumsan dictum, nisi libero ultricies ipsum, in posuere mauris neque at erat.
                                                            <span class="tag">&lt;/td&gt;</span>
                                                        <span class="tag">&lt;/tr&gt;</span>
                                                    <span class="tag">&lt;/table&gt;</span>
                                                <span class="tag">&lt;/td&gt;</span>
                                            <span class="tag">&lt;/tr&gt;</span>
                                        <span class="tag">&lt;/table&gt;</span>
                                    <span class="tag">&lt;/td&gt;</span>
                                <span class="tag">&lt;/tr&gt;</span>
                            <span class="tag">&lt;/table&gt;</span>
                        <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;/tr&gt;</span>
                    <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td</span> <span class="attribute-name">bgcolor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#ee4c50</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_8</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                            <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                <span class="tag">&lt;tr&gt;</span>
                                    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_9</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">white</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">75%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                        <span class="entity">&amp;reg;</span> Someone, somewhere 2013<span class="tag">&lt;br</span><span class="tag">/&gt;</span>
                                        <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a_2a02_0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">white</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;font</span> <span class="attribute-name">color</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#ffffff</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Unsubscribe<span class="tag">&lt;/font&gt;</span><span class="tag">&lt;/a&gt;</span> to this newsletter instantly
                                    <span class="tag">&lt;/td&gt;</span>
                                    <span class="tag">&lt;td</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                        <span class="tag">&lt;table</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cellspacing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                            <span class="tag">&lt;tr&gt;</span>
                                                <span class="tag">&lt;td</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">link</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                    <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.twitter.com/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">white</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                        <span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/images/tw.gif</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Twitter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">38</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">38</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                                                    <span class="tag">&lt;/a&gt;</span>
                                                <span class="tag">&lt;/td&gt;</span>
                                                <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">td_2a02_11</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="entity">&amp;nbsp;</span><span class="tag">&lt;/td&gt;</span>
                                                <span class="tag">&lt;td</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">link</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                    <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.twitter.com/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">white</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                                        <span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/withImagesAndCss/images/fb.gif</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Facebook</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">38</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">38</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                                                    <span class="tag">&lt;/a&gt;</span>
                                                <span class="tag">&lt;/td&gt;</span>
                                            <span class="tag">&lt;/tr&gt;</span>
                                        <span class="tag">&lt;/table&gt;</span>
                                    <span class="tag">&lt;/td&gt;</span>
                                <span class="tag">&lt;/tr&gt;</span>
                            <span class="tag">&lt;/table&gt;</span>
                        <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;/tr&gt;</span>
                <span class="tag">&lt;/table&gt;</span>
            <span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/withImagesAndCss/resources.html?ts=4">Source code of the HTML template</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/css.png" alt="css" width="37" height="30"></span> CSS and images</p>
</div>
<div class="listingblock highlight-lines:4">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">TODO: add CSS file</code></pre>
</div>
</div>
<div class="paragraph">
<p>Images</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/html.png" alt="html" width="37" height="30"></span> Sent HTML</p>
</div>
<div class="listingblock highlight-lines:4">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">TODO: sent HTML</code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> <code>&lt;img&gt;</code> tags that use local images are embedded (using <code>cid</code> reference)</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> <code>&lt;img&gt;</code> tags that use local images are embedded (using base64 data URI)</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Use XHTML instead of HTML</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> Tables used for layout explicitly set default values</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Remove HTML comments (except conditional comments used to target Outlook)</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Add border=0 on all images to avoid an ugly border</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Do not write shortcut CSS values (<code>padding: 4px 4px 4px 4px;</code> instead of <code>padding: 4px</code>)</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Padding is not supported on some clients so you must use margins instead (adding a parent just for the layout)</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Background images on body should be moved on another node</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="text-alternative"><a class="anchor" href="#text-alternative"></a>A working preview of the HTML body (text alternative)</h4>
<div class="paragraph">
<p>Sending an email with HTML content <strong>and</strong> text content might be really important, at least for smartphones. When a smartphone receives an email, it displays the sender, the subject and also a preview of the message, using the text alternative. If the message is only HTML, the preview might be unreadable.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample using HTML and text</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10 irrelevant-lines:1-10,12-21,24-31 highlight-lines:40">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HtmlAndTextSample</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> html = <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;!DOCTYPE html&gt;</span><span class="delimiter">&quot;</span></span>
                                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="delimiter">&quot;</span></span>
                                +   <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;head&gt;&lt;meta charset=</span><span class="char">\&quot;</span><span class="content">utf-8</span><span class="char">\&quot;</span><span class="content"> /&gt;&lt;/head&gt;</span><span class="delimiter">&quot;</span></span>
                                +   <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="delimiter">&quot;</span></span>
                                +       <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h1 class=</span><span class="char">\&quot;</span><span class="content">title</span><span class="char">\&quot;</span><span class="content">&gt;Hello World&lt;/h1&gt;</span><span class="delimiter">&quot;</span></span>
                                +       <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p class=</span><span class="char">\&quot;</span><span class="content">text</span><span class="char">\&quot;</span><span class="content">&gt;Foo bar&lt;/p&gt;</span><span class="delimiter">&quot;</span></span>
                                +   <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="delimiter">&quot;</span></span>
                                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> text = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !</span><span class="char">\r</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                                + <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo bar</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using the fluent API</span>
        service.send(<span class="keyword">new</span> Email()
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="keyword">new</span> MultiContent(text, html))      <i class="conum" data-value="1"></i><b>(1)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The content is using the type <code>MultiContent</code> with a text and HTML content</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/HtmlAndTextSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Just switching to a <code>MultiContent</code> let you provide a main content and an alternative content.</p>
</div>
<div class="paragraph">
<p>Obviously, you can use templates too. Even better, the following sample shows the shorthand version that avoids specifying twice the path to the templates (a single path without extension for both HTML and text template files).</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample using HTML and text templates</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10,38-50 irrelevant-lines:1-10,13-20 highlight-lines:32-33">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiTemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HtmlAndTextTemplateSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using fluent API</span>
        <span class="comment">// Note that the extension of the template is not given. This version</span>
        <span class="comment">// automatically takes the provided path and adds the '.html' extension</span>
        <span class="comment">// for the HTML template and '.txt' for text template</span>
        service.send(<span class="keyword">new</span> Email()
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="keyword">new</span> MultiTemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/thymeleaf/simple</span><span class="delimiter">&quot;</span></span>,       <i class="conum" data-value="1"></i><b>(1)</b>
                                                            <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))                 <i class="conum" data-value="2"></i><b>(2)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The content is using the type <code>MultiTemplateContent</code> with only a path to the template files (without extension)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The object used for evaluation as usual when using templates (same object used for both HTML and text)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/HtmlAndTextTemplateSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf-text.jpg" alt="thymeleaf text" width="30" height="30"></span> Text template</p>
</div>
<div class="listingblock">
<div class="title">Text template located in <code>src/main/resources/template/thymeleaf/simple.txt</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot; th:inline=&quot;text&quot; th:remove=&quot;tag&quot;&gt;
[[${name}]] [[${value}]]
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/thymeleaf/simple.txt?ts=4">Source code of the text template</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf-html.jpg" alt="thymeleaf html" width="30" height="30"></span> HTML template</p>
</div>
<div class="listingblock">
<div class="title">HTML template located at <code>src/main/resources/template/thymeleaf/simple.html</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>       <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>         <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/thymeleaf/simple.html?ts=4">Source code of the HTML template</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Ogham will automatically determine file extensions to append according to the kind of message you are sending. For email, Ogham will search a HTML and a text file by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using ThymeLeaf, the file extensions are <code>.html</code> and <code>.txt</code> (configurable).</p>
</li>
<li>
<p>Using FreeMarker, Ogham will search files with extensions <code>.html.ftl</code> and <code>.txt.ftl</code> (configurable).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using a <code>MultiTemplateContent</code> and you only provide one template (only <code>HTML</code> for example). Ogham will not fail by default (configurable). Therefore, you can start your code with only a HTML template and add the text template later when you need it. That way, your Java code doesn&#8217;t require any change.</p>
</div>
<div class="paragraph">
<p>It is possible to mix templates in the same application. Even better, you can use a template engine that is better suited for HTML like Thymeleaf and FreeMarker that is better for textual version for the same email. Just write your templates with the engine you want.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample using HTML with ThymeLeaf and text with FreeMarker</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10,38-50 irrelevant-lines:1-10,13-20 highlight-lines:32-33">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiTemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HtmlAndTextMixedTemplateEnginesSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using fluent API</span>
        <span class="comment">// Note that the extension of the template is not given. This version</span>
        <span class="comment">// automatically takes the provided path and adds the '.html' extension</span>
        <span class="comment">// for the HTML template and '.txt.ftl' for text template</span>
        service.send(<span class="keyword">new</span> Email()
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="keyword">new</span> MultiTemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/mixed/simple</span><span class="delimiter">&quot;</span></span>,       <i class="conum" data-value="1"></i><b>(1)</b>
                                                            <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))             <i class="conum" data-value="2"></i><b>(2)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The content is using the type <code>MultiTemplateContent</code> with only a path to the template files (without extension)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The object used for evaluation as usual when using templates (same object used for both HTML and text)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/HtmlAndTextMixedTemplateEnginesSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/freemarker-logo.png" alt="freemarker logo" width="60" height="24"></span> Text template</p>
</div>
<div class="listingblock">
<div class="title">Text template located in <code>src/main/resources/template/mixed/simple.txt.ftl</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">${name} ${value}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/mixed/simple.txt.ftl?ts=4">Source code of the text template</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> HTML template</p>
</div>
<div class="listingblock">
<div class="title">HTML template located at <code>src/main/resources/template/mixed/simple.html</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/mixed/simple.html?ts=4">Source code of the HTML template</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>You can notice that the Java code has not changed at all (only the path for the sample). The aim is to use the template engine that best suits your needs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attach_files_to_the_email"><a class="anchor" href="#_attach_files_to_the_email"></a>Attach files to the email</h4>
<div class="paragraph tab-container no-max-height">
<p>Sample with attachment</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-12 irrelevant-lines:1-12,15-22 highlight-lines:33-34">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.InputStream</span>;
<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.attachment.Attachment</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">WithAttachmentSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;email address to display for the sender user&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="comment">// send the email using fluent API</span>
        service.send(<span class="keyword">new</span> Email()
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">content of the email</span><span class="delimiter">&quot;</span></span>)
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>)
                        .attach(<span class="keyword">new</span> Attachment(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/attachment/test.pdf</span><span class="delimiter">&quot;</span></span>))           <i class="conum" data-value="1"></i><b>(1)</b>
                        .attach(<span class="keyword">new</span> Attachment(<span class="string"><span class="delimiter">&quot;</span><span class="content">from-stream.pdf</span><span class="delimiter">&quot;</span></span>, loadInputStream())));     <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">InputStream</span> loadInputStream() {
        <span class="keyword">return</span> WithAttachmentSample.class.getResourceAsStream(<span class="string"><span class="delimiter">&quot;</span><span class="content">/attachment/test.pdf</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Attach a PDF file that exists in the classpath to the email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use an <code>InputStream</code> and name the attachment</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/WithAttachmentSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Attaching a file the the email is quite simple. You just need to provide the path to the file. The file is loaded from classpath but could also be loaded from file system or anywhere else (see <a href="#resource-resolution">resource resolution section</a>). In case you are using a file, the name of the attachment displayed in the email is automatically determined (<code>test.pdf</code> in the example).</p>
</div>
<div class="paragraph">
<p>It is often not possible to handle files directly. In that case you will use <code>InputStream</code> or <code>byte[]</code>. In that case, you need to name the attachment explicitly.</p>
</div>
<div class="paragraph">
<p>In both cases, the mimetype is automatically determined (<code>application/pdf</code> in this case). Mimetype is really important to ensure that the recipient(s) will be able to download or view the files correctly.</p>
</div>
<div class="paragraph">
<p>The file content is link to the email using <code>ContentDisposition.ATTACHMENT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using <code>InputStream</code>, you need to close the stream after sending the email.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also add a custom description for any attachment and link the file content to the email using <code>ContentDisposition.INLINE</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_globally_configure_default_recipients"><a class="anchor" href="#_globally_configure_default_recipients"></a>Globally configure default recipients</h4>

</div>
<div class="sect3">
<h4 id="_provide_authentication"><a class="anchor" href="#_provide_authentication"></a>Provide authentication</h4>

</div>
<div class="sect3">
<h4 id="_use_ssl"><a class="anchor" href="#_use_ssl"></a>Use SSL</h4>

</div>
<div class="sect3">
<h4 id="_send_email_through_gmail"><a class="anchor" href="#_send_email_through_gmail"></a>Send email through GMail</h4>
<div class="paragraph">
<p>This sample shows how to send a basic email through GMail. Sending through GMail is simply using username/password authentication and enabling SSL.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>GMail SSL sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:-7 irrelevant-lines:-7 highlight-lines:16-22">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email.gmail</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">GmailSSLBasicSample</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties (properties can be externalized)</span>
        MessagingService service = MessagingBuilder.standard()                                      <i class="conum" data-value="1"></i><b>(1)</b>
            .environment()
                .properties()                                                                       <i class="conum" data-value="2"></i><b>(2)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.auth</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)                                                  <i class="conum" data-value="3"></i><b>(3)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">smtp.gmail.com</span><span class="delimiter">&quot;</span></span>)                                        <i class="conum" data-value="4"></i><b>(4)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">465</span><span class="delimiter">&quot;</span></span>)                                                   <i class="conum" data-value="5"></i><b>(5)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.socketFactory.class</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.net.ssl.SSLSocketFactory</span><span class="delimiter">&quot;</span></span>)         <i class="conum" data-value="6"></i><b>(6)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.javamail.authenticator.username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your gmail username&gt;</span><span class="delimiter">&quot;</span></span>)    <i class="conum" data-value="7"></i><b>(7)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.javamail.authenticator.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your gmail password&gt;</span><span class="delimiter">&quot;</span></span>)    <i class="conum" data-value="8"></i><b>(8)</b>
                    .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your gmail address&gt;</span><span class="delimiter">&quot;</span></span>)                                <i class="conum" data-value="9"></i><b>(9)</b>
                    .and()
                .and()
            .build();
        <span class="comment">// send the mail using fluent API</span>
        service.send(<span class="keyword">new</span> Email()                                                                    <i class="conum" data-value="10"></i><b>(10)</b>
                        .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>)
                        .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">email content</span><span class="delimiter">&quot;</span></span>)
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the standard builder to configure and instantiate the MessagingService as usual</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the fluent API to provide configuration properties (this is exactly the same as providing <code>java.util.Properties</code> object)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>GMail requires authentication so property <code>mail.smtp.auth</code> must be set to true (this is the standard JavaMail behavior)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>GMail SMTP host (using JavaMail standard property)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>GMail SMTP port (using JavaMail standard property)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>GMail uses SSL (JavaMail requires this special property to enable SSL)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Provide your GMail username</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Provide your Gmail password</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Provide your GMail email address</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Send the email</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/gmail/GmailSSLBasicSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Using GMail server is quite easy. This samples shows several things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The code to send email is still the same.</p>
</li>
<li>
<p>The properties can be provided in a fluent way.</p>
</li>
<li>
<p>SSL is enabled using standard JavaMail property.</p>
</li>
<li>
<p>Authentication is done using properties. JavaMail doesn&#8217;t provide this shortcut. Without Ogham, you have to implement an <a href="http://docs.oracle.com/javaee/7/api/javax/mail/Authenticator.html">Authenticator</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sendgrid"><a class="anchor" href="#sendgrid"></a>Sending email through SendGrid</h4>
<div class="paragraph">
<p>Sending an email using SendGrid HTTP API is exactly the same in term of code. The only difference is the configuration of Ogham.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample using SendGrid</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-42,63-75 irrelevant-lines:1-42 highlight-lines:51">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.email.sendgrid</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiTemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.attachment.Attachment</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="comment">/**
 * This sample shows how to send email with following characteristics:
 * &lt;ul&gt;
 * &lt;li&gt;Use templates&lt;/li&gt;
 * &lt;li&gt;Use template prefix&lt;/li&gt;
 * &lt;li&gt;The HTML template uses external CSS and images&lt;/li&gt;
 * &lt;li&gt;The HTML template loads page fragments&lt;/li&gt;
 * &lt;li&gt;The subject is extracted from templates&lt;/li&gt;
 * &lt;li&gt;Send HTML email with text fallback&lt;/li&gt;
 * &lt;li&gt;Add attachments to the email&lt;/li&gt;
 * &lt;li&gt;Properties are loaded from external file and API key is set in code&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;p&gt;
 * The templates are available in src/main/resources/template/thymeleaf/email:
 * &lt;ul&gt;
 * &lt;li&gt;full.html&lt;/li&gt;
 * &lt;li&gt;full.txt&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;p&gt;
 * The HTML template uses a page fragment that is available in
 * src/main/resources/template/thymeleaf/email/fragments/header.html.
 *
 * &lt;p&gt;
 * The HTML template also references external CSS and images that are available
 * in src/main/resources/resources.
 *
 * @author Aurlien Baudet
 *
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SendGridFullSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">/sendgrid-template.properties</span><span class="delimiter">&quot;</span></span>)                                    <i class="conum" data-value="1"></i><b>(1)</b>
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.sengrid.api-key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your sendgrid API key&gt;</span><span class="delimiter">&quot;</span></span>)              <i class="conum" data-value="2"></i><b>(2)</b>
                        .and()
                    .and()
                .build();
        <span class="comment">// send the email using fluent API</span>
        service.send(<span class="keyword">new</span> Email()
                        .content(<span class="keyword">new</span> MultiTemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))       <i class="conum" data-value="3"></i><b>(3)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham-test@yopmail.com</span><span class="delimiter">&quot;</span></span>)
                        .attach(<span class="keyword">new</span> Attachment(<span class="string"><span class="delimiter">&quot;</span><span class="content">/attachment/test.pdf</span><span class="delimiter">&quot;</span></span>)));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load properties from a file that is in the classpath.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use an <code>InputStream</code> and name the attachment</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/SendGridFullSample.java?ts=4">Source code of the sample</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> Properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># ogham additional properties</span>
ogham.email.from=&lt;sender email address&gt;                             <i class="conum" data-value="1"></i><b>(1)</b>
ogham.email.template.path-prefix=/template/thymeleaf/email/         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The sender email address</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A prefix for all template paths. In this example, the template paths are <code>/template/thymeleaf/email/full.html</code> and <code>/template/thymeleaf/email/full.txt</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/sendgrid-template.properties?ts=4">Source code of the configuration file</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sms-usage"><a class="anchor" href="#sms-usage"></a>Send SMS</h3>
<div class="paragraph">
<p>The samples are available in the <a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage">sample-standard-usage sub-project</a>.</p>
</div>
<div class="paragraph">
<p>All samples shown bellow are using SMPP for sending SMS. The <a href="https://en.wikipedia.org/wiki/Short_Message_Peer-to-Peer">SMPP</a> protocol is the standard way to send SMS.</p>
</div>
<div class="paragraph">
<p>See <a href="#ovh">Sending SMS through OVH</a> to know how to send SMS using OVH HTTP API.</p>
</div>
<div class="sect3">
<h4 id="_first_sms_using_an_existing_smpp_server"><a class="anchor" href="#_first_sms_using_an_existing_smpp_server"></a>First SMS using an existing SMPP server</h4>
<div class="paragraph">
<p>This sample defines two properties mandatory (system ID and password) by this protocol in order to use it.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Simple sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-9 irrelevant-lines:1-9">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.sms</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BasicSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);                        <i class="conum" data-value="1"></i><b>(1)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);                        <i class="conum" data-value="2"></i><b>(2)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.system-id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server system ID&gt;</span><span class="delimiter">&quot;</span></span>);              <i class="conum" data-value="3"></i><b>(3)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server password&gt;</span><span class="delimiter">&quot;</span></span>);                <i class="conum" data-value="4"></i><b>(4)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;phone number to display for the sender&gt;</span><span class="delimiter">&quot;</span></span>);       <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()                                      <i class="conum" data-value="6"></i><b>(6)</b>
                .environment()
                    .properties(properties)                                                         <i class="conum" data-value="7"></i><b>(7)</b>
                    .and()
                .build();                                                                           <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="comment">// send the sms using fluent API</span>
        service.send(<span class="keyword">new</span> Sms()                                                                      <i class="conum" data-value="9"></i><b>(9)</b>
                        .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">sms content</span><span class="delimiter">&quot;</span></span>)
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">+33752962193</span><span class="delimiter">&quot;</span></span>));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the SMPP server host</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the SMPP server port</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The SMPP system ID</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The SMPP password</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The phone number of the sender</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use the standard builder (predefined behavior)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Register the custom properties</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Create a MessagingService instance</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Send a SMS with a simple message. The sender phone number is automatically set using <code>ogham.sms.from</code> property</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/sms/BasicSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>The construction of the SMS is done using a fluent API in order to chain calls and to have a more readable code.</p>
</div>
<div class="paragraph">
<p>Properties are directly provided in the code. You can instead <a href="#properties-handling">use a configuration file</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sms-template"><a class="anchor" href="#sms-template"></a>use a template for SMS content</h4>
<div class="paragraph">
<p>This sample shows how to send a SMS with a content following a template engine language.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample with template</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-10,36-48 irrelevant-lines:1-10,13-22 highlight-lines:30,31">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.sms</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TemplateSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.system-id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server system ID&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server password&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;phone number to display for the sender&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()                                      <i class="conum" data-value="1"></i><b>(1)</b>
                .environment()
                    .properties(properties)                                                         <i class="conum" data-value="2"></i><b>(2)</b>
                    .and()
                .build();                                                                           <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="comment">// send the sms using fluent API</span>
        service.send(<span class="keyword">new</span> Sms()                                                                      <i class="conum" data-value="4"></i><b>(4)</b>
                        .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/template/thymeleaf/simple.txt</span><span class="delimiter">&quot;</span></span>,    <i class="conum" data-value="5"></i><b>(5)</b>
                                                    <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))                     <i class="conum" data-value="6"></i><b>(6)</b>
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">+33752962193</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the standard builder (predefined behavior)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register the custom properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a MessagingService instance</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send a SMS with message that comes from the evaluated template. The sender address is automatically set using <code>ogham.sms.from</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Indicate the path to the template file (in the classpath)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use any bean object for replacing variables in template</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/sms/TemplateSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> ThymeLeaf template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:inline</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:remove</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
[[${name}]] [[${value}]]
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/thymeleaf/simple.txt?ts=4">Source code of the template</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Using a template is straightforward. Instead of providing a string content, you provide a <code>TemplateContent</code>.
The <code>TemplateContent</code> requires two information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The path to the template</p>
</li>
<li>
<p>The variables to evaluate in the template</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The path to the template is a string with a <strong>lookup</strong> prefix. The lookup prefix is used to indicate where to search the template (from file system, from classpath or anywhere else). Here we explicitly ask to load the template from classpath (using prefix <code>classpath:</code>). If no lookup is defined, classpath is used by default. See <a href="#resource-resolution">Resource resolution section</a> for more information.</p>
</div>
<div class="paragraph">
<p>The variables are any object you are using in your application. No need to convert your object to a particular format. Directly use what you want.</p>
</div>
</div>
<div class="sect3">
<h4 id="auto-split-sms"><a class="anchor" href="#auto-split-sms"></a>Send a long SMS</h4>
<div class="paragraph">
<p>As you may know, SMS stands for Short Message Service. Basically, the messages are limited to a maximum of 160 characters if character encoding is using 7bits. Using a 8-bit character encoding decreases the limit to 140 characters and 70 characters for a 16-bit encoding. If needed, the library will split your messages into several parts the right way to be recomposed by clients later (according to the message encoding). Therefore, you don&#8217;t need to handle the split of messages in your code:</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Long SMS Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-9 irrelevant-lines:1-9,12-21 highlight-lines:27-30">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.sms</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">LongMessageSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server host&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server port&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.system-id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server system ID&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your server password&gt;</span><span class="delimiter">&quot;</span></span>);
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;phone number to display for the sender&gt;</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(properties)
                    .and()
                .build();
        <span class="predefined-type">String</span> longMessage = <span class="string"><span class="delimiter">&quot;</span><span class="content">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad </span><span class="delimiter">&quot;</span></span>
                            + <span class="string"><span class="delimiter">&quot;</span><span class="content">minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehender</span><span class="delimiter">&quot;</span></span>
                            + <span class="string"><span class="delimiter">&quot;</span><span class="content">it in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui o</span><span class="delimiter">&quot;</span></span>
                            + <span class="string"><span class="delimiter">&quot;</span><span class="content">fficia deserunt mollit anim id est laborum.</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// send the sms using fluent API</span>
        service.send(<span class="keyword">new</span> Sms()
                        .content(longMessage)
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">+33752962193</span><span class="delimiter">&quot;</span></span>));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/sms/LongMessageSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Larger content (concatenated SMS, multipart or segmented SMS, or "long SMS") can be sent using multiple messages, in which case each message will start with a User Data Header (UDH) containing segmentation information. Since UDH is part of the payload, the number of available characters per segment is lower: 153 for 7-bit encoding, 134 for 8-bit encoding and 67 for 16-bit encoding. The receiving handset is then responsible for reassembling the message and presenting it to the user as one long message. While the standard theoretically permits up to 255 segments, 6 to 8 segment messages are the practical maximum.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Ogham sends the SMS using 8-bit encoding.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sending_sms_through_smsglobal"><a class="anchor" href="#_sending_sms_through_smsglobal"></a>Sending SMS through SmsGlobal</h4>
<div class="paragraph">
<p>You can send SMS using <a href="https://www.smsglobal.com/">SmsGlobal</a> SMPP server:</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>SmsGlobal sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-9 highlight-lines:15-18">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard.sms.smsglobal</span>;

<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BasicSmsglobalSmppSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        <span class="comment">// configure properties (could be stored in a properties file or defined</span>
        <span class="comment">// in System properties)</span>
        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">smsglobal.com</span><span class="delimiter">&quot;</span></span>);                                         <i class="conum" data-value="1"></i><b>(1)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1775</span><span class="delimiter">&quot;</span></span>);                                                  <i class="conum" data-value="2"></i><b>(2)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.system-id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your smsglobal username available in API keys&gt;</span><span class="delimiter">&quot;</span></span>);  <i class="conum" data-value="3"></i><b>(3)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your smsglobal password available in API keys&gt;</span><span class="delimiter">&quot;</span></span>);   <i class="conum" data-value="4"></i><b>(4)</b>
        properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;phone number to display for the sender&gt;</span><span class="delimiter">&quot;</span></span>);                   <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="comment">// Instantiate the messaging service using default behavior and</span>
        <span class="comment">// provided properties</span>
        MessagingService service = MessagingBuilder.standard()                                                  <i class="conum" data-value="6"></i><b>(6)</b>
                .environment()
                    .properties(properties)                                                                     <i class="conum" data-value="7"></i><b>(7)</b>
                    .and()
                .build();                                                                                       <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="comment">// send the sms using fluent API</span>
        service.send(<span class="keyword">new</span> Sms()                                                                                  <i class="conum" data-value="9"></i><b>(9)</b>
                        .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">sms content</span><span class="delimiter">&quot;</span></span>)
                        .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">+33752962193</span><span class="delimiter">&quot;</span></span>));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The SmsGlobal server host</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The SmsGlobal server port</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Your SmsGlobal username</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Your SmsGlobal password</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The sender phone number</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use the standard builder to configure and instantiate the MessagingService as usual</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Provide configuration properties to Ogham as usual</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Instantiate the service as usual</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Send the SMS as usual</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/sms/smsglobal/BasicSmsglobalSmppSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_sending_sms_through_ovh"><a class="anchor" href="#_sending_sms_through_ovh"></a>Sending SMS through OVH</h4>
<div class="paragraph">
<p>You can send SMS using <a href="http://guides.ovh.com/Http2Sms">OVH</a> HTTP API:</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resource-resolution"><a class="anchor" href="#resource-resolution"></a>Resource resolution</h3>
<div class="paragraph">
<p>Resource resolution is used to locate files using a simple path. For example, the path of a file you want to use (template, image, CSS, attachment&#8230;&#8203;) could be <code>foo/bar/aaa.b</code>. But the file could be located:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either in the classpath</p>
</li>
<li>
<p>or on the file system</p>
</li>
<li>
<p>or anywhere else (could be in a database, on a HTTP endpoint&#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ogham provides resource resolution abstraction. Any path can contain an information used to indicate which resolver to use to find and read the file content. For example, if the previous path stands for a file that is in the classpath, the Ogham path is <code>classpath:foo/bar/aaa.b</code>. On the contrary, if the path represents a file that is on file system, the Ogham path is <code>file:foo/bar/aaa.b</code>. In both cases, the path is prefixed by a string named lookup prefix (respectively <code>classpath:</code> and <code>file:</code>).</p>
</div>
<div class="paragraph">
<p>Ogham configures by default (through <code>MessagingBuilder.standard()</code> or <code>MessagingBuilder.minimal()</code>) several resource resolvers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A resolver that is able to locate and read files from the file system with lookup prefix <code>file:</code>.</p>
</li>
<li>
<p>A resolver that is able to locate and read files from the classpath with lookup prefix <code>classpath:</code>.</p>
</li>
<li>
<p>A resolver that doesn&#8217;t load file from path but directly uses the string as content with lookups <code>string:</code> or <code>s:</code>.</p>
</li>
<li>
<p>A default resolver with no lookup that is able to locate and read files from the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each resolver that is able to handle a path may also handle a path prefix and a path suffix. This is useful in order to provide only a subset of the path (only the file name for example) to Ogham and let Ogham find the real path of the file. For example if you configure Ogham with the prefix <code>foo/bar</code> and <code>.b</code> suffix for both classpath and file resolvers, you can ask Ogham to find the file <code>foo/bar/aaa.b</code> using the path <code>classpath:aaa</code> or <code>file:aaa</code>. Prefix and suffix can be changed using configuration properties (when using <code>MessagingBuilder.standard()</code> or <code>MessagingBuilder.minimal()</code>). There exists one property by message type (email or SMS), by resolver type (classpath or file), by template engine (ThymeLeaf or FreeMarker). Ogham also provides shared configuration properties (configure once for all):</p>
</div>
<table class="tableblock frame-all grid-all spread resource-resolution-properties">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template engine</th>
<th class="tableblock halign-left valign-top">Message type</th>
<th class="tableblock halign-left valign-top">Resolver type</th>
<th class="tableblock halign-left valign-top">Properties (ordered by higher priority)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ThymeLeaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Classpath</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.email.thymeleaf.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.thymeleaf.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ThymeLeaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.email.thymeleaf.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.thymeleaf.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ThymeLeaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Classpath</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.sms.thymeleaf.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.thymeleaf.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ThymeLeaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.sms.thymeleaf.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.thymeleaf.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeMarker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Classpath</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.email.freemarker.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.freemarker.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeMarker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.email.freemarker.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.freemarker.path-prefix</code></p>
</li>
<li>
<p><code>ogham.email.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeMarker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Classpath</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.sms.freemarker.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.classpath.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.freemarker.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeMarker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>ogham.sms.freemarker.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.file.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.freemarker.path-prefix</code></p>
</li>
<li>
<p><code>ogham.sms.template.path-prefix</code></p>
</li>
<li>
<p><code>ogham.template.path-prefix</code></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also <a href="#custom-resource-resolver">define your own resource resolver</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="properties-handling"><a class="anchor" href="#properties-handling"></a>Properties handling</h3>
<div class="paragraph">
<p>Property configuration is a good way to separate code from configuration. Ogham allows you to configure values using builders. For example, you can configure the SMTP host and port like this:</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MessagingBuilder.standard()
    .email()
        .sender(JavaMailBuilder.class)
            .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>)
            .port(<span class="integer">25</span>);</code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>However, when using a library, it is simpler that this library provides a way to configure some values without the need of writing code to configure it. The integration is easier. The configuration should also be done in several ways to let the developer choose what fits his needs.</p>
</div>
<div class="paragraph">
<p>You can use configuration properties that are defined several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in a properties file that is present in the classpath (inside the application)</p>
</li>
<li>
<p>in a properties file that is present on the file system (outside the application)</p>
</li>
<li>
<p>using standard <code>java.util.Properties</code></p>
</li>
<li>
<p>using standard <code>System.getProperties()</code></p>
</li>
<li>
<p>define properties directly in code in a fluent way</p>
</li>
</ul>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-9 irrelevant-lines:1-9">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">PropertiesSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException, <span class="exception">IOException</span> {
        <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hello@world.com</span><span class="delimiter">&quot;</span></span>);
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(props)                                      <i class="conum" data-value="1"></i><b>(1)</b>
                    .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:email.properties</span><span class="delimiter">&quot;</span></span>)               <i class="conum" data-value="2"></i><b>(2)</b>
                    .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:/etc/app/email.properties</span><span class="delimiter">&quot;</span></span>)           <i class="conum" data-value="3"></i><b>(3)</b>
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)                        <i class="conum" data-value="4"></i><b>(4)</b>
                        .and()
                    .systemProperties()                                     <i class="conum" data-value="5"></i><b>(5)</b>
                    .and()
                .build();
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use standard <code>java.util.Properties</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the file from the classpath (relative to root of the classpath)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Load the file from the file system</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Directly set a property with its value in a fluent way</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use standard <code>System.getProperties()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/fr/sii/ogham/sample/standard/PropertiesSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>This sample shows that configuration may come from several sources (code, shared properties, file inside the application, file outside the application and from system properties).</p>
</div>
<div class="sect3">
<h4 id="_properties_priority"><a class="anchor" href="#_properties_priority"></a>Properties priority</h4>
<div class="paragraph">
<p>If you define properties using several different ways, you may have the same key several times. In that case, which value will be used by Ogham ?</p>
</div>
<div class="paragraph">
<p>By default (using <code>MessagingBuilder.standard()</code> or <code>MessagingBuilder.minimal()</code>), Ogham defines the following order (first is used if defined):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.systemProperties()</code></p>
</li>
<li>
<p><code>.properties("file:..")</code></p>
</li>
<li>
<p><code>.properties(new Properties())</code> or <code>.properties().set(&#8230;&#8203;)</code></p>
</li>
<li>
<p><code>.properties("classpath:&#8230;&#8203;")</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_why_this_order"><a class="anchor" href="#_why_this_order"></a>Why this order ?</h5>
<div class="paragraph">
<p>Configuration outside the application should override configuration that is inside the application. This is necessary if you want to be able to deploy the same application in different environments without changing code or needing to rebuild with a different profile.</p>
</div>
<div class="paragraph">
<p>For configuration outside the application, system properties (defined either in system environment or using java command line arguments) has higher priority than a configuration file outside the application. This is useful to have a configuration file that is shared between several applications or instances and override only some values explicitly.</p>
</div>
<div class="paragraph">
<p>For configuration inside the application, code has higher priority than configuration defined in a classpath file. This is useful to define global configuration for the application using a configuration file and let the possibility to override explicitly some values in code. This is useful in tests for example.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-9 irrelevant-lines:1-9">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.standard</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">PropertiesSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException, <span class="exception">IOException</span> {
        <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hello@world.com</span><span class="delimiter">&quot;</span></span>);
        MessagingService service = MessagingBuilder.standard()
                .environment()
                    .properties(props)                                      <i class="conum" data-value="1"></i><b>(1)</b>
                    .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:email.properties</span><span class="delimiter">&quot;</span></span>)               <i class="conum" data-value="2"></i><b>(2)</b>
                    .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:/etc/app/email.properties</span><span class="delimiter">&quot;</span></span>)           <i class="conum" data-value="3"></i><b>(3)</b>
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)                        <i class="conum" data-value="4"></i><b>(4)</b>
                        .and()
                    .systemProperties()                                     <i class="conum" data-value="5"></i><b>(5)</b>
                    .and()
                .build();
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use standard <code>java.util.Properties</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the file from the classpath (relative to root of the classpath)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Load the file from the file system</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Directly set a property with its value in a fluent way</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use standard <code>System.getProperties()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/java/fr/sii/ogham/sample/standard/email/fr/sii/ogham/sample/standard/PropertiesSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> classpath:email.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">mail.smtp.host=localhost
mail.smtp.port=<span class="integer">25</span>
ogham.email.from=foo<span class="decorator">@test.com</span></code></pre>
</div>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> file:/etc/app/email.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">mail.smtp.host=smtp.domain.com</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Result</p>
</div>
<div class="paragraph">
<p>Running this sample with the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ java -Dogham.email.from="bar@domain.com" fr.sii.ogham.sample.standard.PropertiesSample</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives the following property values:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Result value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.smtp.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>smtp.domain.com</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.smtp.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ogham.email.from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>bar@domain.com</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See the <a href="https://github.com/groupe-sii/ogham/blob/master/ogham-all/src/test/java/fr/sii/ogham/it/env/PropertyOverrideTest.java?ts=4">test that ensures this order</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_what_happens_if_there_are_several_values_for_the_same_property_and_for_the_same_source"><a class="anchor" href="#_what_happens_if_there_are_several_values_for_the_same_property_and_for_the_same_source"></a>What happens if there are several values for the same property and for the same source ?</h5>
<div class="paragraph">
<p>For example, if you use two configuration files defined in the classpath:</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    MessagingService service = MessagingBuilder.standard()
            .environment()
                .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:common.properties</span><span class="delimiter">&quot;</span></span>)
                .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:email.properties</span><span class="delimiter">&quot;</span></span>)
                .and()
            .build();</code></pre>
</div>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> common.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">mail.smtp.host=localhost
mail.smtp.port=<span class="integer">25</span></code></pre>
</div>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> email.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">mail.smtp.host=smtp.domain.com</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Result</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Result value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.smtp.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>smtp.domain.com</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.smtp.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
</tbody>
</table>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>For the same level of priority, this is the declaration order that prevails.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use_custom_priorities"><a class="anchor" href="#_how_to_use_custom_priorities"></a>How to use custom priorities ?</h5>
<div class="paragraph">
<p>If you want to use a different priority order, you can explicitly register properties with a custom priority:</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    MessagingService service = MessagingBuilder.standard()
            .environment()
                .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:common.properties</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
                .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:email.properties</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
                .and()
            .build();</code></pre>
</div>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> common.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">mail.smtp.host=localhost
mail.smtp.port=<span class="integer">25</span></code></pre>
</div>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> email.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">mail.smtp.host=smtp.domain.com</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Result</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Result value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.smtp.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>localhost</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.smtp.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
</tbody>
</table>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>You can notice that the result is now different than using default priorities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Default priority values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using <code>.systemProperties()</code>: 100000</p>
</li>
<li>
<p>Load property file from the filesystem (<code>properties("file:&#8230;&#8203;")</code>: 90000</p>
</li>
<li>
<p>Using custom <code>java.util.Properties</code> object (<code>properties(new Properties())</code>): 80000</p>
</li>
<li>
<p>Using custom properties through <code>.properties()</code> fluent API: 80000</p>
</li>
<li>
<p>Load property file from the classpath (<code>properties("classpath:&#8230;&#8203;")</code>): 70000</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_templating"><a class="anchor" href="#_templating"></a>Templating</h3>
<div class="sect3">
<h4 id="freemarker"><a class="anchor" href="#freemarker"></a>FreeMarker</h4>

</div>
<div class="sect3">
<h4 id="thymeleaf"><a class="anchor" href="#thymeleaf"></a>ThymeLeaf</h4>

</div>
<div class="sect3">
<h4 id="_mixed"><a class="anchor" href="#_mixed"></a>Mixed</h4>

</div>
</div>
<div class="sect2">
<h3 id="spring-boot-usage"><a class="anchor" href="#spring-boot-usage"></a>Using Ogham in a Spring Boot application</h3>
<div class="paragraph">
<p>Ogham provides auto-configuration modules for Spring Boot (<a href="#install-spring-boot">see how to include auto-configuration modules</a>). To use Ogham in Spring, you can directly inject (autowire) <code>MessagingService</code> bean.</p>
</div>
<div class="paragraph">
<p>In addition to standalone behaviors, Ogham also supports Spring Boot modules and auto-configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>spring-boot-starter-thymeleaf</code> is included, Ogham uses Spring ThymeLeaf template engine (using <code>SpringTemplateEngine</code> bean), configuration and properties (<code>spring.thymeleaf</code> properties)</p>
</li>
<li>
<p>If <code>spring-boot-starter-freemarker</code> is included, Ogham uses Spring FreeMarker properties (<code>spring.freemarker</code> properties)</p>
</li>
<li>
<p>If <code>spring-boot-starter-mail</code> is included, Ogham uses Spring mail properties (<code>spring.mail</code> properties)</p>
</li>
<li>
<p>If <code>sendgrid-java</code> is included, Ogham uses Spring SendGrid bean and properties (<code>spring.sendgrid</code> properties)</p>
</li>
<li>
<p>Provide properties metadata for auto-completion</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">SendGrid auto-configuration</div>
<div class="paragraph">
<p>Including all Ogham features adds <code>sendgrid-java</code> dependency. This means that Spring Boot auto-configuration for SendGrid automatically defines the <code>sendGrid</code> bean instance if <code>spring.sendgrid.api-key</code> property is defined. In this case, the <code>sendGrid</code> bean is always used by Ogham.
Before Spring Boot 2.0.0, <code>spring.sendgrid.username</code> and <code>spring.sendgrid.password</code> can be provided instead of <code>spring.sendgrid.api-key</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_send_email"><a class="anchor" href="#_send_email"></a>Send email</h4>
<div class="paragraph">
<p>Usage of <code>MessagingService</code> is exactly the same as standalone usage. The only difference is that <code>MessagingService</code> is automatically created and injectable.
The following sample shows a Spring Web that exposes one simple endpoint for sending email using Ogham. The sample shows several Ogham features at once:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using both HTML (using ThymeLeaf) and text templates (using FreeMarker)</p>
</li>
<li>
<p>Templates are located in a sub-folder and prefixes for templates are configured using Spring standard properties</p>
</li>
<li>
<p>Using a configuration property to define the sender address</p>
</li>
<li>
<p>The SMTP server host and port are defined using Spring standard properties</p>
</li>
<li>
<p>The email subject is provided by the <code>title</code> tag of the HTML template</p>
</li>
</ul>
</div>
<div class="paragraph tab-container no-max-height">
<p>Email sample with Spring Boot</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-18,48-60 irrelevant-lines:1-18 highlight-lines:33,34,40-43">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.springboot.email</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.PropertySource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.http.HttpStatus</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RequestMapping</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RequestMethod</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RequestParam</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.ResponseStatus</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RestController</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiTemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application-email-template.properties</span><span class="delimiter">&quot;</span></span>)    <span class="comment">// just needed to be able to run the sample</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ThymeleafHtmlAndFreemarkerTextSample</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        SpringApplication.run(ThymeleafHtmlAndFreemarkerTextSample.class, args);
    }

    <span class="annotation">@RestController</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">EmailController</span> {
        <span class="comment">// Messaging service is automatically created using Spring Boot features</span>
        <span class="comment">// The configuration can be set into application-email-template.properties</span>
        <span class="comment">// The configuration files are stored into src/main/resources</span>
        <span class="comment">// The configuration file set the prefix for templates into email folder available in src/main/resources</span>
        <span class="annotation">@Autowired</span>
        MessagingService messagingService;                                                          <i class="conum" data-value="1"></i><b>(1)</b>

        <span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">api/email/multitemplate/mixed</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.POST)
        <span class="annotation">@ResponseStatus</span>(HttpStatus.CREATED)
        <span class="directive">public</span> <span class="type">void</span> sendEmail(<span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> to, <span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name, <span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> value) <span class="directive">throws</span> MessagingException {
            <span class="comment">// using fluent API</span>
            messagingService.send(<span class="keyword">new</span> Email()                                                       <i class="conum" data-value="2"></i><b>(2)</b>
                                    .content(<span class="keyword">new</span> MultiTemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">mixed</span><span class="delimiter">&quot;</span></span>,                      <i class="conum" data-value="3"></i><b>(3)</b>
                                                                    <span class="keyword">new</span> SimpleBean(name, value)))   <i class="conum" data-value="4"></i><b>(4)</b>
                                    .to(to));                                                       <i class="conum" data-value="5"></i><b>(5)</b>
        }
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject Ogham service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the Ogham service to send an email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use HTML and text templates that are available in classpath. Spring is configured to use a path prefix for both ThymeLeaf and FreeMarker (see properties configuration tab). Both HTML and text templates are then located respectively at <code>src/main/resources/email/mixed.html</code> and <code>src/main/resources/email/mixed.txt/ftl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use any Java object for evaluating template variables</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The sender email address that comes from request parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/java/fr/sii/ogham/sample/springboot/email/ThymeleafHtmlAndFreemarkerTextSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> HTML template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Subject of the mail<span class="tag">&lt;/title&gt;</span>              <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>       <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>         <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Include the ThymeLeaf namespace</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>title</code> tag to define the subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Evaluate the <code>name</code> attribute value of <code>SimpleBean</code> in the template</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Evaluate the <code>value</code> attribute value of <code>SimpleBean</code> in the template</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/resources/email/mixed.html?ts=4">Source code of the HTML template</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/freemarker-logo.png" alt="freemarker logo" width="60" height="24"></span> Text template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">${name} ${value}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/resources/email/mixed.txt.ftl?ts=4">Source code of the text template</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> Spring properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># configuration for email</span>
spring.mail.host=&lt;your server host&gt;     <i class="conum" data-value="1"></i><b>(1)</b>
spring.mail.port=&lt;your server port&gt;     <i class="conum" data-value="2"></i><b>(2)</b>
ogham.email.from=&lt;your gmail address&gt;   <i class="conum" data-value="3"></i><b>(3)</b>
<span class="comment"># configuration for template engines</span>
spring.thymeleaf.prefix=/email/         <i class="conum" data-value="4"></i><b>(4)</b>
spring.freemarker.prefix=/email/        <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The SMTP host using Spring property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The SMTP port using Spring property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The sender address that is declared globally</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The path prefix for ThymeLeaf templates</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The path prefix for FreeMarker templates</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/resources/application-email-template.properties?ts=4">Source code of the properties</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_send_sms"><a class="anchor" href="#_send_sms"></a>Send SMS</h4>
<div class="paragraph">
<p>Usage of <code>MessagingService</code> is exactly the same as standalone usage. The only difference is that <code>MessagingService</code> is automatically created and injectable.
The following sample shows a Spring Web that exposes one simple endpoint for sending SMS using Ogham. The sample shows several Ogham features at once:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using text template (using FreeMarker)</p>
</li>
<li>
<p>Templates are located in a sub-folder and prefix for SMS templates is configured through Ogham property</p>
</li>
<li>
<p>SMS template extension is configured globally in order to avoid extension in Java code</p>
</li>
<li>
<p>Using a configuration property to define the sender phone number</p>
</li>
<li>
<p>The SMPP server host, port and authentication are defined using properties</p>
</li>
</ul>
</div>
<div class="paragraph tab-container no-max-height">
<p>SMS Sample with Spring Boot</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-18,47-59 irrelevant-lines:1-18 highlight-lines:32,33,39-42">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.springboot.sms</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.PropertySource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.http.HttpStatus</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RequestMapping</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RequestMethod</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RequestParam</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.ResponseStatus</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RestController</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application-sms-template.properties</span><span class="delimiter">&quot;</span></span>)  <span class="comment">// just needed to be able to run the sample</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TemplateSample</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> MessagingException {
        SpringApplication.run(TemplateSample.class, args);
    }

    <span class="annotation">@RestController</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SmsController</span> {
        <span class="comment">// Messaging service is automatically created using Spring Boot features</span>
        <span class="comment">// The configuration can be set into application-sms-template.properties</span>
        <span class="comment">// The configuration files are stored into src/main/resources</span>
        <span class="annotation">@Autowired</span>
        MessagingService messagingService;                                                      <i class="conum" data-value="1"></i><b>(1)</b>

        <span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">api/sms/template</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.POST)
        <span class="annotation">@ResponseStatus</span>(HttpStatus.CREATED)
        <span class="directive">public</span> <span class="type">void</span> sendSms(<span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> to, <span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name, <span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> value) <span class="directive">throws</span> MessagingException {
            <span class="comment">// send the SMS using fluent API</span>
            messagingService.send(<span class="keyword">new</span> Sms()                                                     <i class="conum" data-value="2"></i><b>(2)</b>
                                    .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">register</span><span class="delimiter">&quot;</span></span>,                    <i class="conum" data-value="3"></i><b>(3)</b>
                                                                <span class="keyword">new</span> SimpleBean(name, value)))   <i class="conum" data-value="4"></i><b>(4)</b>
                                    .to(to));                                                   <i class="conum" data-value="5"></i><b>(5)</b>
        }
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject Ogham service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the Ogham service to send a SMS</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use a text template as SMS content</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use any Java object for evaluating template variables</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The sender phone number that comes from request parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/java/fr/sii/ogham/sample/springboot/sms/TemplateSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/freemarker-logo.png" alt="freemarker logo" width="60" height="24"></span> Template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Hello ${name}, the confirmation code is ${value}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/resources/sms/register.txt.ftl?ts=4">Source code of the template</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/properties.png" alt="properties" width="37" height="30"></span> Spring properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># ogham configuration for SMS</span>
ogham.sms.smpp.host=&lt;your server host&gt;                      <i class="conum" data-value="1"></i><b>(1)</b>
ogham.sms.smpp.port=&lt;your server port&gt;                      <i class="conum" data-value="2"></i><b>(2)</b>
ogham.sms.smpp.system-id=&lt;your server system ID&gt;            <i class="conum" data-value="3"></i><b>(3)</b>
ogham.sms.smpp.password=&lt;your server password&gt;              <i class="conum" data-value="4"></i><b>(4)</b>
ogham.sms.from=&lt;phone number to display <span class="keyword">for</span> the sender&gt;     <i class="conum" data-value="5"></i><b>(5)</b>
ogham.sms.template.path-prefix=/sms/                        <i class="conum" data-value="6"></i><b>(6)</b>
ogham.sms.template.path-suffix=.txt.ftl                     <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The SMPP host</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The SMPP port</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The SMPP system ID (account)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The SMPP password</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The sender phone number that is declared globally</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The path prefix for SMS templates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The path suffix for SMS templates (FreeMarker extension in this case)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-spring-usage/src/main/resources/application-sms-template.properties?ts=4">Source code of the properties</a></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing"><a class="anchor" href="#_testing"></a>Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="testing-tools"><a class="anchor" href="#testing-tools"></a>Include test utilities</h3>
<div class="paragraph tab-container">
<p>Include Ogham test dependency</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/maven-logo.png" alt="Maven" width="118" height="30"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>fr.sii.ogham<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>ogham-test-utils<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/pom.xml?ts=4">View code of an example pom.xml</a></p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/gradlephant-logo.png" alt="Gradle" width="114" height="30"></span></p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>This will include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://junit.org/junit4/">JUnit to run tests</a></p>
</li>
<li>
<p><a href="http://site.mockito.org/">Mockito for mocking Java code</a></p>
</li>
<li>
<p><a href="http://hamcrest.org/JavaHamcrest/">Hamcrest for assertions</a></p>
</li>
<li>
<p><a href="http://www.icegreen.com/greenmail/">GreenMail for mocking a SMTP server</a></p>
</li>
<li>
<p><a href="https://jsmpp.org/">jSMPP for mocking a SMPP server</a></p>
</li>
<li>
<p><a href="http://wiremock.org/">WireMock for mocking HTTP server</a></p>
</li>
<li>
<p><a href="http://spockframework.org/">Spockframework for writing very very readable unit tests</a></p>
</li>
<li>
<p>and some utilities that may be useful</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configure_static_method_imports_for_eclipse"><a class="anchor" href="#_configure_static_method_imports_for_eclipse"></a>Configure static method imports for Eclipse</h4>
<div class="paragraph">
<p>Ogham uses Hamcrest, Mockito and also provides test utilities. Those utilities provide many static methods. Static methods are convenient for code readability. However, Eclipse needs some configuration to help you to import static methods with autocompletion.</p>
</div>
<div class="paragraph">
<p>In Eclipse, select <span class="menuseq"><span class="menu">Window</span>&#160;&#9656; <span class="menuitem">Preferences</span></span>. In the preferences window, select <span class="menuseq"><span class="menu">Java</span>&#160;&#9656; <span class="submenu">Editor</span>&#160;&#9656; <span class="submenu">Content Assist</span>&#160;&#9656; <span class="menuitem">Favorites</span></span>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/static-import-empty.png" alt="static import empty">
</div>
<div class="title">Figure 1. Preferences window</div>
</div>
<div class="paragraph">
<p>To add all static methods of a class, click on <b class="button">New Type&#8230;&#8203;</b>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/static-import-newtype.png" alt="static import newtype">
</div>
<div class="title">Figure 2. Add all static methods and attributes of a class</div>
</div>
<div class="paragraph">
<p>Type the class that contains the static methods (you can also click the browse button to search classes from classpath).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/static-import-newtype-search.png" alt="static import newtype search">
</div>
<div class="title">Figure 3. Example for Ogham assersions</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/static-import-search.png" alt="static import search">
</div>
<div class="title">Figure 4. Search for a class</div>
</div>
<div class="paragraph">
<p>Click on <b class="button">OK</b></p>
</div>
<div class="paragraph">
<p>Recommended imports to add:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fr.sii.ogham.assertion.OghamAssertions.*</code></p>
</li>
<li>
<p><code>org.hamcrest.Matchers.*</code></p>
</li>
<li>
<p><code>org.hamcrest.CoreMatchers.*</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional assertions that may be useful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.mockito.Matchers.*</code></p>
</li>
<li>
<p><code>org.mockito.Mockito.*</code></p>
</li>
<li>
<p><code>org.junit.*</code></p>
</li>
<li>
<p><code>org.junit.Assert.*</code></p>
</li>
<li>
<p><code>org.junit.matchers.JUnitMatchers.*</code></p>
</li>
<li>
<p><code>org.junit.Assume.*</code></p>
</li>
<li>
<p><code>org.assertj.core.api.Assertions.*</code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/static-import-all.png" alt="static import all">
</div>
<div class="title">Figure 5. Result with all static imports described above</div>
</div>
<div class="paragraph">
<p>Once you have added all static imports you need, click on <b class="button">OK</b>.</p>
</div>
<div class="paragraph">
<p>Now you can use autocompletion and Eclipse will automatically add the static import.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/static-import-autocomplete.png" alt="static import autocomplete">
</div>
<div class="title">Figure 6. Autocompletion now suggests static methods</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Eclipse can rewrite a call to a static method prefixed by class. For example in your code you have <code>OghamAssertions.assertThat</code>, pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>M</kbd></span> shortcut (cursor must be placed in the method name), Eclipse will add the static import and the code is just <code>assertThat</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-email"><a class="anchor" href="#testing-email"></a>Testing emails</h3>
<div class="sect3">
<h4 id="_first_test"><a class="anchor" href="#_first_test"></a>First test</h4>
<div class="paragraph">
<p>To test your application emails, you can start a local SMTP server. You can then use Ogham to make assertions on your email (right recipients, right sender, right body&#8230;&#8203;). Ogham uses <a href="http://www.icegreen.com/greenmail/">GreenMail</a> as local SMTP server.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-23 irrelevant-lines:1-23">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);                     <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())                   <i class="conum" data-value="2"></i><b>(2)</b>
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))          <i class="conum" data-value="3"></i><b>(3)</b>
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> simple() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name &lt;recipient@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()                                        <i class="conum" data-value="4"></i><b>(4)</b>
            .count(is(<span class="integer">1</span>))                                                               <i class="conum" data-value="5"></i><b>(5)</b>
            .message(<span class="integer">0</span>)                                                                 <i class="conum" data-value="6"></i><b>(6)</b>
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>))                                                  <i class="conum" data-value="7"></i><b>(7)</b>
                .from()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>))                            <i class="conum" data-value="8"></i><b>(8)</b>
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name</span><span class="delimiter">&quot;</span></span>)).and()                            <i class="conum" data-value="9"></i><b>(9)</b>
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>))                              <i class="conum" data-value="10"></i><b>(10)</b>
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name</span><span class="delimiter">&quot;</span></span>)).and()                         <i class="conum" data-value="11"></i><b>(11)</b>
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body</span><span class="delimiter">&quot;</span></span>))                                 <i class="conum" data-value="12"></i><b>(12)</b>
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)).and()                        <i class="conum" data-value="13"></i><b>(13)</b>
                .alternative(nullValue())                                               <i class="conum" data-value="14"></i><b>(14)</b>
                .attachments(emptyIterable());                                          <i class="conum" data-value="15"></i><b>(15)</b>
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare and initialize the GreenMail JUnit rule to start a local SMTP server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the local SMTP server host address and configure Ogham to use this value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the local SMTP server port and configure Ogham to use this value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Entry point for declaring assertion on received emails using a fluent API</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Assert that one and only one email has been received</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Access the first received message for declaring assertions for that message using fluent API</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Assert that the subject of the first message is exactly <code>Simple</code> string</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Assert that the sender email address is exactly <code>test.sender@sii.fr</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Assert that the sender name is exactly <code>Sender Name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Assert that the recipient email address is exactly <code>recipient@sii.fr</code></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Assert that the recipient name is exactly <code>Recipient Name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Assert that the body of the received email is exactly <code>string body</code></td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Assert that the mimetype of the body of the received email starts with <code>text/plain</code></td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Assert that received email has no alternative content</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Assert that recevied email has no attachment</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/EmailTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_html_message"><a class="anchor" href="#_testing_html_message"></a>Testing HTML message</h4>
<div class="paragraph">
<p>Comparing two HTML documents can be tricky. Indeed, the HTML attributes can be declared in a different order, number of spaces/tabs can be different, some attributes may be declared differently but corresponding to the same behavior (for example <code>disabled</code> attribute can be declared only <code>disabled</code> with no value, <code>disabled="true"</code> or <code>disabled="disabled"</code>).</p>
</div>
<div class="paragraph">
<p>Ogham provides two distinct matchers to check if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTML is identical (exactly the same nodes at same position and same attributes at same position and same value)</p>
</li>
<li>
<p>HTML is similar (exactly the same nodes at same position, same attributes with same values declared in any order)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to comparison helpers, Ogham provides an helper to load files from classpath in tests. This is useful to avoid writing expected HTML content as string in your code and also avoid writing the same utility function every time.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-26,28-45,72-84 irrelevant-lines:1-26 highlight-lines:64">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.isSimilarHtml</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.resourceAsString</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailHtmlTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> registerMessage() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">/template/register.html</span><span class="delimiter">&quot;</span></span>,             <i class="conum" data-value="1"></i><b>(1)</b>
                                                            <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))             <i class="conum" data-value="2"></i><b>(2)</b>
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name &lt;recipient@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">1</span>))
            .message(<span class="integer">0</span>)
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo - Confirm your registration</span><span class="delimiter">&quot;</span></span>))
                .from()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name</span><span class="delimiter">&quot;</span></span>)).and()
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name</span><span class="delimiter">&quot;</span></span>)).and()
                .body()
                    .contentAsString(isSimilarHtml(resourceAsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">/expected/register.html</span><span class="delimiter">&quot;</span></span>)))    <i class="conum" data-value="3"></i><b>(3)</b>
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)).and()
                .alternative(nullValue())
                .attachments(emptyIterable());
        <span class="comment">// @formatter:on</span>
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use an HTML template</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Object used to evaluate variables in the template</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assert that HTML is similar as an expected HTML content</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/EmailHtmlTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> HTML template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 <span class="tag">&lt;head&gt;</span>
  <span class="tag">&lt;title</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">|${name} - Confirm your registration|</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
 <span class="tag">&lt;/head&gt;</span>
 <span class="tag">&lt;body&gt;</span>
  <span class="tag">&lt;h1</span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">|Hello ${name}|</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>

  <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;/p&gt;</span>
 <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/register.html?ts=4">Source code of the template</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/html.png" alt="html" width="37" height="30"></span> Expected HTML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>foo - Confirm your registration<span class="tag">&lt;/title&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/meta&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Hello foo<span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>42<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/resources/expected/register.html?ts=4">Source code of the expected HTML</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_help_in_eclipse_for_failing_tests"><a class="anchor" href="#_help_in_eclipse_for_failing_tests"></a>Help in Eclipse for failing tests</h4>
<div class="paragraph">
<p>When your tests report errors due to HTML differences, Ogham helps with Eclipse integration. The following sample is voluntary in error due to differences between actual HTML and expected HTML (this is the expected HTML that is incorrect) in order to show how Ogham helps you.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-26,28-45,72-84 irrelevant-lines:1-22 highlight-lines:64">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.isSimilarHtml</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.resourceAsString</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.TemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailHtmlTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> registerMessage() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .content(<span class="keyword">new</span> TemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">/template/register.html</span><span class="delimiter">&quot;</span></span>,             <i class="conum" data-value="1"></i><b>(1)</b>
                                                            <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))             <i class="conum" data-value="2"></i><b>(2)</b>
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name &lt;recipient@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">1</span>))
            .message(<span class="integer">0</span>)
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo - Confirm your registration</span><span class="delimiter">&quot;</span></span>))
                .from()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name</span><span class="delimiter">&quot;</span></span>)).and()
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name</span><span class="delimiter">&quot;</span></span>)).and()
                .body()
                    .contentAsString(isSimilarHtml(resourceAsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">/expected/register.html</span><span class="delimiter">&quot;</span></span>)))    <i class="conum" data-value="3"></i><b>(3)</b>
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)).and()
                .alternative(nullValue())
                .attachments(emptyIterable());
        <span class="comment">// @formatter:on</span>
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use an HTML template</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Object used to evaluate variables in the template</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assert that HTML is similar as an expected HTML content</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/EmailHtmlTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> HTML template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 <span class="tag">&lt;head&gt;</span>
  <span class="tag">&lt;title</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">|${name} - Confirm your registration|</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
 <span class="tag">&lt;/head&gt;</span>
 <span class="tag">&lt;body&gt;</span>
  <span class="tag">&lt;h1</span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">|Hello ${name}|</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>

  <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;/p&gt;</span>
 <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/register.html?ts=4">Source code of the template</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/html.png" alt="html" width="37" height="30"></span> Expected HTML</p>
</div>
<div class="listingblock highlight-lines:4,8">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>bar - Confirm your registration<span class="tag">&lt;/title&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/meta&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Hello bar<span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>42<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expected HTML is voluntary wrong:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>title</code> starts with <code>bar</code> instead of <code>foo</code></p>
</li>
<li>
<p><code>h1</code> text is <code>Hello bar</code> instead of <code>Hello foo</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All other differences are not reported as errors as the resulting HTML interpretation will be the same.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/tests-junit-error.png" alt="tests junit error">
</div>
<div class="title">Figure 7. JUnit view</div>
</div>
<div class="paragraph">
<p>Double-clicking on the exception:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/tests-junit-error-open-comparison.png" alt="tests junit error open comparison">
</div>
<div class="title">Figure 8. Exception message is clickable</div>
</div>
<div class="paragraph">
<p>Opens a comparison window:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/tests-comparison.png" alt="tests comparison">
</div>
<div class="title">Figure 9. Comparison window</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Spaces, tag closing and attributes order are reported by the comparison window provided by Eclipse. Indeed, Eclipse just compares two strings (not HTML documents). This window is just an helper to visualize where the problems are. But the real errors to fix are displayed both in logs and in the error summary.
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images//eclipse/tests-junit-error-useful-part.png" alt="tests junit error useful part">
</div>
<div class="title">Figure 10. Useful part of the error summary</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_email_with_an_html_body_and_text_alternative"><a class="anchor" href="#_testing_email_with_an_html_body_and_text_alternative"></a>Testing email with an HTML body and text alternative</h4>
<div class="paragraph">
<p>Tesing an email sent with two main parts (HTML and text fallback) is straightforward.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-26,28-45,71-83 irrelevant-lines:1-26 highlight-lines:60-65">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.isSimilarHtml</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.resourceAsString</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.equalToIgnoringWhiteSpace</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.message.content.MultiTemplateContent</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailHtmlAndTextTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> multiTemplateContent() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Multi</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="keyword">new</span> MultiTemplateContent(<span class="string"><span class="delimiter">&quot;</span><span class="content">template/mixed/simple</span><span class="delimiter">&quot;</span></span>,
                                                                    <span class="keyword">new</span> SimpleBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)))
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">1</span>))
            .message(<span class="integer">0</span>)
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Multi</span><span class="delimiter">&quot;</span></span>))
                .from().address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>)).and()
                .to().address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>)).and()
                .body()                                                                                             <i class="conum" data-value="1"></i><b>(1)</b>
                    .contentAsString(isSimilarHtml(resourceAsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">/expected/simple_bar_42.html</span><span class="delimiter">&quot;</span></span>)))               <i class="conum" data-value="2"></i><b>(2)</b>
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)).and()                                                     <i class="conum" data-value="3"></i><b>(3)</b>
                .alternative()                                                                                      <i class="conum" data-value="4"></i><b>(4)</b>
                    .contentAsString(equalToIgnoringWhiteSpace(resourceAsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">/expected/simple_bar_42.txt</span><span class="delimiter">&quot;</span></span>)))    <i class="conum" data-value="5"></i><b>(5)</b>
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)).and()                                                    <i class="conum" data-value="6"></i><b>(6)</b>
                .attachments(emptyIterable());
        <span class="comment">// @formatter:on</span>
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleBean</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> name;
        <span class="directive">private</span> <span class="type">int</span> value;
        <span class="directive">public</span> SimpleBean(<span class="predefined-type">String</span> name, <span class="type">int</span> value) {
            <span class="local-variable">super</span>();
            <span class="local-variable">this</span>.name = name;
            <span class="local-variable">this</span>.value = value;
        }
        <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
            <span class="keyword">return</span> name;
        }
        <span class="directive">public</span> <span class="type">int</span> getValue() {
            <span class="keyword">return</span> value;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to main body assertions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assert that main body message is HTML content and is similar as an expected HTML content loaded from classpath</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assert that main body message mimetype is <code>text/html</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access to alternative assertions</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Assert that alternative body message is text content and is exactly the expected text content loaded from classpath</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Assert that alternative body message mimetype is <code>text/plain</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/EmailHtmlAndTextTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/thymeleaf.jpg" alt="thymeleaf" width="30" height="30"></span> HTML template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/mixed/simple.html?ts=4">Source code of the template</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/freemarker-logo.png" alt="freemarker logo" width="60" height="24"></span> Text template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">${name} ${value}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/main/resources/template/mixed/simple.txt.ftl?ts=4">Source code of the template</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/html.png" alt="html" width="37" height="30"></span> Expected HTML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>

<span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>bar<span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>42<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/resources/expected/simple_bar_42.html?ts=4">Source code of the expected HTML</a>.</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/txt.png" alt="txt" width="30" height="30"></span> Expected text</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>bar 42</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/resources/expected/simple_bar_42.txt?ts=4">Source code of the expected text</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_attachments"><a class="anchor" href="#_testing_attachments"></a>Testing attachments</h4>
<div class="paragraph">
<p>You can also test that attachments are sent correctly.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-26,28-45 irrelevant-lines:1-26 highlight-lines:64-69">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.resource</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.helper.email.EmailUtils.ATTACHMENT_DISPOSITION</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasSize</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.attachment.Attachment</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailAttachmentTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> simple() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>)
                                .attach(<span class="keyword">new</span> Attachment(<span class="string"><span class="delimiter">&quot;</span><span class="content">/attachment/test.pdf</span><span class="delimiter">&quot;</span></span>)));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">1</span>))
            .message(<span class="integer">0</span>)
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>))
                .from().address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>)).and()
                .to().address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>)).and()
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>))
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)).and()
                .alternative(nullValue())
                .attachments(hasSize(<span class="integer">1</span>))                                    <i class="conum" data-value="1"></i><b>(1)</b>
                .attachment(<span class="integer">0</span>)                                              <i class="conum" data-value="2"></i><b>(2)</b>
                    .content(is(resource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/attachment/test.pdf</span><span class="delimiter">&quot;</span></span>)))          <i class="conum" data-value="3"></i><b>(3)</b>
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/pdf</span><span class="delimiter">&quot;</span></span>))             <i class="conum" data-value="4"></i><b>(4)</b>
                    .filename(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.pdf</span><span class="delimiter">&quot;</span></span>))                               <i class="conum" data-value="5"></i><b>(5)</b>
                    .disposition(is(ATTACHMENT_DISPOSITION));               <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Assert that exactly one attachment is attached to the received email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the first attachment for defining assertions on it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assert that the first received file is exactly the same as the sent one</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assert that the detected mimetype of the first attachment is correct</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Assert that the name of the first attachment is the expected one</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Assert that the attachment disposition is correct</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/EmailAttachmentTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_several_emails_at_once"><a class="anchor" href="#_testing_several_emails_at_once"></a>Testing several emails at once</h4>
<div class="paragraph">
<p>When you send an email to several recipients, there is one message per recipient. So if you send an email to 6 recipients, you may need to ensure that the 6 messages are received correctly. Ogham provides the <code>forEach</code> method to apply defined assertions on all messages.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-24,26-43 irrelevant-lines:1-24 highlight-lines:55">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.containsInAnyOrder</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SeveralRecipientsTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> severalRecipients() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient1@sii.fr</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">recipient2@sii.fr</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">recipient3@sii.fr</span><span class="delimiter">&quot;</span></span>)
                                .cc(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient4@sii.fr</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">recipient5@sii.fr</span><span class="delimiter">&quot;</span></span>)
                                .bcc(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient6@sii.fr</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">6</span>))                                                               <i class="conum" data-value="1"></i><b>(1)</b>
            .forEach()                                                                  <i class="conum" data-value="2"></i><b>(2)</b>
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>))
                .from()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name</span><span class="delimiter">&quot;</span></span>)).and()
                .to()
                    .address(containsInAnyOrder(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient1@sii.fr</span><span class="delimiter">&quot;</span></span>,                    <i class="conum" data-value="3"></i><b>(3)</b>
                                                <span class="string"><span class="delimiter">&quot;</span><span class="content">recipient2@sii.fr</span><span class="delimiter">&quot;</span></span>,
                                                <span class="string"><span class="delimiter">&quot;</span><span class="content">recipient3@sii.fr</span><span class="delimiter">&quot;</span></span>)).and()
                .cc()
                    .address(containsInAnyOrder(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient4@sii.fr</span><span class="delimiter">&quot;</span></span>,                    <i class="conum" data-value="4"></i><b>(4)</b>
                                                <span class="string"><span class="delimiter">&quot;</span><span class="content">recipient5@sii.fr</span><span class="delimiter">&quot;</span></span>)).and()
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body</span><span class="delimiter">&quot;</span></span>))
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)).and()
                .alternative(nullValue())
                .attachments(emptyIterable());
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Assert that 6 distinct messages are received</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>forEach</code> applies all later defined assertions to all messages (the 6 messages)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assert that each received messages has exactly 3 <code>to</code> recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assert that each received messages has exactly 2 <code>cc</code> recipients</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>bcc</code> recipient is not testable. Indeed, <code>bcc</code> recipients are hidden recipients that must not be visible. So the email is received (there are 6 received messages not 5). But <code>bcc</code> field of each email are empty because they are not present in the sent email. The <code>bcc</code> field is just used for routing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/SeveralRecipientsTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Sometimes you also need to send several different emails. The emails may have some identical information (sender or subject for example). So you can mix <code>forEach</code> (define assertions all messages) with <code>message</code> (define assertion for one particular message).</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-23,25-42 irrelevant-lines:1-23 highlight-lines:60,70,78,86">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest.SMTP</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SeveralEmailsTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;test.sender@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, SMTP.getBindAddress())
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(SMTP.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> severalDisctinctMessages() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body 1</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient1@sii.fr</span><span class="delimiter">&quot;</span></span>));
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body 2</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient2@sii.fr</span><span class="delimiter">&quot;</span></span>));
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body 3</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient3@sii.fr</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">3</span>))
            .forEach()                                                  <i class="conum" data-value="1"></i><b>(1)</b>
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>))
                .from()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name</span><span class="delimiter">&quot;</span></span>)).and()
                .body()
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)).and()
                .alternative(nullValue())
                .attachments(emptyIterable())
                .and()
            .message(<span class="integer">0</span>)                                                 <i class="conum" data-value="2"></i><b>(2)</b>
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body 1</span><span class="delimiter">&quot;</span></span>))
                    .and()
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient1@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .and()
                .and()
            .message(<span class="integer">1</span>)                                                 <i class="conum" data-value="3"></i><b>(3)</b>
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body 2</span><span class="delimiter">&quot;</span></span>))
                    .and()
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient2@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .and()
                .and()
            .message(<span class="integer">2</span>)                                                 <i class="conum" data-value="4"></i><b>(4)</b>
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body 3</span><span class="delimiter">&quot;</span></span>))
                    .and()
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient3@sii.fr</span><span class="delimiter">&quot;</span></span>));
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shared assertions (subject, sender and body mimetype)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specific assertions for first sent message (recipient and message content)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specific assertions for second sent message (recipient and message content)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specific assertions for third sent message (recipient and message content)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/SeveralEmailsTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_with_smtp_authentication"><a class="anchor" href="#_testing_with_smtp_authentication"></a>Testing with SMTP authentication</h4>
<div class="paragraph">
<p>GreenMail allows to start the SMTP server with user and credentials.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-25,27-34 irrelevant-lines:1-25,52-75 highlight-lines:37,41-43">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.it.email</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.emptyIterable</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasItems</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.nullValue</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.junit.GreenMailRule</span>;
<span class="keyword">import</span> <span class="include">com.icegreen.greenmail.util.ServerSetupTest</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.email.message.Email</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.helper.rule.LoggingTestRule</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailSMTPAuthenticationTest</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> LoggingTestRule loggingRule = <span class="keyword">new</span> LoggingTestRule();

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> GreenMailRule greenMail = <span class="keyword">new</span> GreenMailRule(ServerSetupTest.SMTP);

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        greenMail.setUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);                             <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">Properties</span> additionalProps = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        additionalProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.host</span><span class="delimiter">&quot;</span></span>, ServerSetupTest.SMTP.getBindAddress());
        additionalProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(ServerSetupTest.SMTP.getPort()));
        additionalProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.auth</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);                                          <i class="conum" data-value="2"></i><b>(2)</b>
        additionalProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.javamail.authenticator.username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender</span><span class="delimiter">&quot;</span></span>);      <i class="conum" data-value="3"></i><b>(3)</b>
        additionalProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.email.javamail.authenticator.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);         <i class="conum" data-value="4"></i><b>(4)</b>
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties(<span class="string"><span class="delimiter">&quot;</span><span class="content">/application.properties</span><span class="delimiter">&quot;</span></span>)
                    .properties(additionalProps)
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> authenticated() <span class="directive">throws</span> MessagingException, javax.mail.MessagingException {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Email()
                                .subject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>)
                                .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body</span><span class="delimiter">&quot;</span></span>)
                                .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name &lt;recipient@sii.fr&gt;</span><span class="delimiter">&quot;</span></span>));
        assertThat(greenMail).receivedMessages()
            .count(is(<span class="integer">1</span>))
            .message(<span class="integer">0</span>)
                .subject(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simple</span><span class="delimiter">&quot;</span></span>))
                .from()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.sender@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name</span><span class="delimiter">&quot;</span></span>)).and()
                .to()
                    .address(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">recipient@sii.fr</span><span class="delimiter">&quot;</span></span>))
                    .personal(hasItems(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recipient Name</span><span class="delimiter">&quot;</span></span>)).and()
                .body()
                    .contentAsString(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">string body</span><span class="delimiter">&quot;</span></span>))
                    .contentType(startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)).and()
                .alternative(nullValue())
                .attachments(emptyIterable());
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure GreenMail to register a user</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure JavaMail to enable authentication</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure Ogham to provide the authentication username</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure Ogham to provide the authentication password</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/ogham-all/src/test/java/fr/sii/ogham/it/email/EmailSMTPAuthenticationTest.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the setup differs, the test is the same.
</td>
</tr>
</table>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-sms"><a class="anchor" href="#testing-sms"></a>Tesing SMS</h3>
<div class="sect3">
<h4 id="_first_test_2"><a class="anchor" href="#_first_test_2"></a>First test</h4>
<div class="paragraph">
<p>To test your application SMS, you can start a local SMPP server. You can then use Ogham to make assertions on you SMS (recipient phone number, sender phone number and message). Ogham uses <a href="https://jsmpp.org/">jSMPP</a> as local SMPP server.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-19 irrelevant-lines:1-19">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.jsmpp.bean.SubmitSm</span>;
<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.helper.sms.rule.JsmppServerRule</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.helper.sms.rule.SmppServerRule</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SmsTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> SmppServerRule&lt;SubmitSm&gt; smppServer = <span class="keyword">new</span> JsmppServerRule();                   <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">+33603040506</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>)                                <i class="conum" data-value="2"></i><b>(2)</b>
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(smppServer.getPort()))       <i class="conum" data-value="3"></i><b>(3)</b>
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> simple() <span class="directive">throws</span> MessagingException {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Sms()
                            .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">sms content</span><span class="delimiter">&quot;</span></span>)
                            .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">0601020304</span><span class="delimiter">&quot;</span></span>));
        assertThat(smppServer).receivedMessages()                                               <i class="conum" data-value="4"></i><b>(4)</b>
            .count(is(<span class="integer">1</span>))                                                                       <i class="conum" data-value="5"></i><b>(5)</b>
            .message(<span class="integer">0</span>)                                                                         <i class="conum" data-value="6"></i><b>(6)</b>
                .content(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">sms content</span><span class="delimiter">&quot;</span></span>))                                                     <i class="conum" data-value="7"></i><b>(7)</b>
                .from()
                    .number(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">+33603040506</span><span class="delimiter">&quot;</span></span>))                                                 <i class="conum" data-value="8"></i><b>(8)</b>
                    .and()
                .to()
                    .number(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">0601020304</span><span class="delimiter">&quot;</span></span>));                                                  <i class="conum" data-value="9"></i><b>(9)</b>
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare and initialize the JUnit rule that encapsulates jSMPP for starting a local SMPP server in tests (you can set a different port than the default one)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure Ogham to use <code>localhost</code> for SMPP host</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the local SMPP server port and configure Ogham to use this value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Entry point for declaring assertion on received SMS using a fluent API</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Assert that one and only one SMS has been received</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Access the first received message for declaring assertions for that message using fluent API</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Assert that the received message text is exactly <code>sms content</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Assert that the sender phone number is <code>+33603040506</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Assert that the recipient phone number is <code>0601020304</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/SmsTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_long_messages_and_several_recipients"><a class="anchor" href="#_testing_long_messages_and_several_recipients"></a>Testing long messages and several recipients</h4>
<div class="paragraph">
<p>When a long message is sent, it must be split. Each part of the message is received by the SMPP server as distinct messages. The first message doesn&#8217;t have any additional information indicating that it is split. Successive messages have an additional header (contained in the body). Ogham hides this protocol specific complexity. So you can test your SMS without needing to know about the header. Ogham provides <code>message</code> method to access a particular message for doing assertions on it. Ogham also provides <code>forEach</code> to apply same assertions on all received messages.</p>
</div>
<div class="paragraph">
<p>Sending a SMS to several recipients is the same as sending several distinct SMS. So the SMPP server receives the same number as SMS as the number of recipients. In that case, you can use <code>forEach</code> to make same assertions on all messages.</p>
</div>
<div class="paragraph tab-container no-max-height">
<p>Sample</p>
</div>
<div class="paragraph tab">
<p><span class="image"><img src="../images//icons/java-logo.png" alt="java logo" width="16" height="30"></span> Java</p>
</div>
<div class="listingblock collapse-lines:1-19 irrelevant-lines:1-19,21-38 highlight-lines:56">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.sii.ogham.sample.test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">fr.sii.ogham.assertion.OghamAssertions.assertThat</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.jsmpp.bean.SubmitSm</span>;
<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.builder.MessagingBuilder</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.exception.MessagingException</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.core.service.MessagingService</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.helper.sms.rule.JsmppServerRule</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.helper.sms.rule.SmppServerRule</span>;
<span class="keyword">import</span> <span class="include">fr.sii.ogham.sms.message.Sms</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">LongSmsTestSample</span> {
    <span class="directive">private</span> MessagingService oghamService;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> SmppServerRule&lt;SubmitSm&gt; smppServer = <span class="keyword">new</span> JsmppServerRule();

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">IOException</span> {
        oghamService = MessagingBuilder.standard()
                .environment()
                    .properties()
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">+33603040506</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>)
                        .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">ogham.sms.smpp.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.valueOf(smppServer.getPort()))
                        .and()
                    .and()
                .build();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> longMessage() <span class="directive">throws</span> MessagingException, <span class="exception">IOException</span> {
        <span class="comment">// @formatter:off</span>
        oghamService.send(<span class="keyword">new</span> Sms()
                            .content(<span class="string"><span class="delimiter">&quot;</span><span class="content">sms content with a very very very loooooooooo</span><span class="delimiter">&quot;</span></span>
                                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">oooooooooonnnnnnnnnnnnnnnnng message that is</span><span class="delimiter">&quot;</span></span>
                                    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> over 160 characters in order to test the be</span><span class="delimiter">&quot;</span></span>
                                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">havior of the sender when message has to be split</span><span class="delimiter">&quot;</span></span>)
                            .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">0601020304</span><span class="delimiter">&quot;</span></span>));
        assertThat(smppServer).receivedMessages()
            .count(is(<span class="integer">2</span>))                                                                   <i class="conum" data-value="1"></i><b>(1)</b>
            .message(<span class="integer">0</span>)                                                                     <i class="conum" data-value="2"></i><b>(2)</b>
                .content(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">sms content with a very very very looooooooooooooooooo</span><span class="delimiter">&quot;</span></span>        <i class="conum" data-value="3"></i><b>(3)</b>
                        + <span class="string"><span class="delimiter">&quot;</span><span class="content">onnnnnnnnnnnnnnnnng message that is over 160 characters </span><span class="delimiter">&quot;</span></span>
                        + <span class="string"><span class="delimiter">&quot;</span><span class="content">in order to test the beh</span><span class="delimiter">&quot;</span></span>)).and()
            .message(<span class="integer">1</span>)                                                                     <i class="conum" data-value="4"></i><b>(4)</b>
                .content(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">avior of the sender when message has to be split</span><span class="delimiter">&quot;</span></span>)).and()      <i class="conum" data-value="5"></i><b>(5)</b>
            .forEach()                                                                      <i class="conum" data-value="6"></i><b>(6)</b>
                .from()
                    .number(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">+33603040506</span><span class="delimiter">&quot;</span></span>))                                             <i class="conum" data-value="7"></i><b>(7)</b>
                    .and()
                .to()
                    .number(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">0601020304</span><span class="delimiter">&quot;</span></span>));                                              <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="comment">// @formatter:on</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Message is split so the SMPP server receives two messages</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access first message to declare assertions on it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assert that the first message is correctly split (contains the beginning of the message)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access second message to declare assertions on it</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Assert that the second message contains the end of the whole message</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>forEach</code> applies all later defined assertions to all messages (the 2 messages here)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Assert that the sender phone number is <code>+33603040506</code> for every message</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Assert that the recipient phone number is <code>0601020304</code> for every message</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/groupe-sii/ogham/blob/master/sample-standard-usage/src/test/java/fr/sii/ogham/sample/test/LongSmsTestSample.java?ts=4">Source code of the sample</a>.</p>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_configuration"><a class="anchor" href="#_advanced_configuration"></a>Advanced configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_use_the_builder_to_define_your_own_behaviors"><a class="anchor" href="#_use_the_builder_to_define_your_own_behaviors"></a>Use the builder to define your own behaviors</h3>
<div class="sect3">
<h4 id="_standard_builder"><a class="anchor" href="#_standard_builder"></a>Standard builder</h4>

</div>
<div class="sect3">
<h4 id="_minimal_builder"><a class="anchor" href="#_minimal_builder"></a>Minimal builder</h4>

</div>
<div class="sect3">
<h4 id="_empty_builder"><a class="anchor" href="#_empty_builder"></a>Empty builder</h4>

</div>
<div class="sect3">
<h4 id="_interceptors"><a class="anchor" href="#_interceptors"></a>Interceptors</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extend"><a class="anchor" href="#_extend"></a>Extend</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_your_own_configurer"><a class="anchor" href="#_create_your_own_configurer"></a>Create your own configurer</h3>

</div>
<div class="sect2">
<h3 id="_use_a_custom_message_sender"><a class="anchor" href="#_use_a_custom_message_sender"></a>Use a custom message sender</h3>

</div>
<div class="sect2">
<h3 id="_use_your_custom_template_engine"><a class="anchor" href="#_use_your_custom_template_engine"></a>Use your custom template engine</h3>

</div>
<div class="sect2">
<h3 id="custom-resource-resolver"><a class="anchor" href="#custom-resource-resolver"></a>Create custom resource resolver</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_tips"><a class="anchor" href="#_tips"></a>Tips</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-06 08:47:30 CEST
</div>
</div>
</body>
</html>